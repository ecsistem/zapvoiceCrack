import{O as l}from"./chunk-BqDfMDXV.js";async function m(s){a.checkChromeStorage();const e=await chrome.storage.local.get(s);if(!e[s])return null;if(typeof e[s]!="string")return e[s];try{return JSON.parse(e[s])}catch{return e[s]??null}}async function h(s){return a.checkChromeStorage(),(await chrome.storage.local.get(s))[s]??null}async function S(s){a.checkChromeStorage(),await chrome.storage.local.set(s)}async function u(s){a.checkChromeStorage(),await chrome.storage.local.remove(s)}function g(s,e){a.checkChromeStorage(),chrome.storage.onChanged.addListener(t=>{e&&e.length>0?e.some(n=>Object.keys(t).includes(n))&&s(t):s(t)})}class d{async getParsedFromStorage(e){return m(e)}async getNonParsedFromStorage(e){return h(e)}async setOnStorage(e){await S(e)}async removeFromStorage(e){await u(e)}addStorageListener(e,t){g(e,t)}}class a{static checkChromeStorage(){const e=typeof chrome>"u"||typeof chrome.storage>"u";return e&&console.error("❌ Chrome storage is not available"),e===!1}static async getParsedFromStorage(e){return m(e)}static async getNonParsedFromStorage(e){return h(e)}static async setOnStorage(e){await S(e)}static async removeFromStorage(e){await u(e)}static addChromeStorageListener(e,t){g(e,t)}}async function f(s){const e=await c.checkChromeSessionStorage();if(!e)return null;const t=e[s];if(!t)return null;if(typeof t!="string")return t;try{return JSON.parse(t)}catch{return t??null}}async function p(s){const e=await c.checkChromeSessionStorage();return e?e[s]??null:null}async function w(s){const e=await c.checkChromeSessionStorage();if(e){for(const[t,n]of Object.entries(s))e[t]=n;await a.setOnStorage({"zv-session":e})}}async function y(s){c.checkChromeSessionStorage()&&await chrome.storage.local.remove(s)}class c{static async clear(){await a.removeFromStorage("zv-session")}static async checkChromeSessionStorage(){if(!a.checkChromeStorage())return null;const t=await a.getParsedFromStorage("zv-session");return(!t||Object.keys(t).length===0)&&await a.setOnStorage({"zv-session":{}}),t}static async getParsedFromStorage(e){return f(e)}static async getNonParsedFromStorage(e){return p(e)}static async setOnStorage(e){await w(e)}static async removeFromStorage(e){await y(e)}static addChromeStorageListener(e,t){g(e,t)}}class C extends d{constructor(){super(),a.checkChromeStorage()===!1&&typeof alert=="function"&&alert("⚠️ ZustandChromeStorage implemented without chrome storage")}async getParsedItem(e){return await this.getParsedFromStorage(e)}async getParsedSessionItem(e){return await c.getParsedFromStorage(e)}async getItem(e){return await this.getNonParsedFromStorage(e)}async setItem(e,t){await this.setOnStorage({[e]:t})}async setSessionItem(e,t){await c.setOnStorage({[e]:t})}async removeItem(e){await this.removeFromStorage(e)}}const F=new l(new C);async function O(s=!1){const e=await chrome.tabs.query({}),t=e.find(r=>{var o,i;return r.active&&((o=r.url)==null?void 0:o.includes("web.whatsapp.com"))&&!((i=r.favIconUrl)!=null&&i.includes("error"))})||e.find(r=>{var o;return r.active&&((o=r.url)==null?void 0:o.includes("web.whatsapp.com"))});return s?t:t||e.find(r=>{var o,i;return((o=r.url)==null?void 0:o.includes("web.whatsapp.com"))&&!((i=r.favIconUrl)!=null&&i.includes("error"))})||e.find(r=>{var o;return(o=r.url)==null?void 0:o.includes("web.whatsapp.com")})}const P=()=>chrome.runtime.getManifest().version;export{a as C,C as Z,P as a,c as b,F as c,O as g};
