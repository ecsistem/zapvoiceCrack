var Ee=Object.defineProperty;var Be=(c,e,s)=>e in c?Ee(c,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[e]=s;var o=(c,e,s)=>Be(c,typeof e!="symbol"?e+"":e,s);import{c as k,p as O,a as $,b as d,u as f,f as Ce,g as Ne}from"./chunk-BqDfMDXV.js";let se;const Pe=new Uint8Array(16);function ke(){if(!se&&(se=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!se))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return se(Pe)}const U=[];for(let c=0;c<256;++c)U.push((c+256).toString(16).slice(1));function Oe(c,e=0){return U[c[e+0]]+U[c[e+1]]+U[c[e+2]]+U[c[e+3]]+"-"+U[c[e+4]]+U[c[e+5]]+"-"+U[c[e+6]]+U[c[e+7]]+"-"+U[c[e+8]]+U[c[e+9]]+"-"+U[c[e+10]]+U[c[e+11]]+U[c[e+12]]+U[c[e+13]]+U[c[e+14]]+U[c[e+15]]}const $e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ye={randomUUID:$e};function Ue(c,e,s){if(ye.randomUUID&&!e&&!c)return ye.randomUUID();c=c||{};const i=c.random||(c.rng||ke)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Oe(i)}class P{constructor(e){o(this,"value");this.value=e??Ue()}toString(){return String(this.value)}toValue(){return this.value}equals(e){return e.toValue()===this.value}}function b(c,e={toLowerCase:!0}){const s=c.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x00-\x7F]/g,"").trim();return e.toLowerCase?s.toLowerCase():s}class Z{constructor(e,s){o(this,"_id");o(this,"props");this.props=e,this._id=s??new P}get id(){return this._id.toValue()}get idEntity(){return this._id}equals(e){return!!(e===this||e.idEntity.equals(this._id))}}class oe extends Z{get asViewOnce(){return this.props.asViewOnce}set asViewOnce(e){this.props.asViewOnce=e}get data(){return this.props.data}set data(e){this.props.data=e}get isFavorite(){return this.props.isFavorite}set isFavorite(e){this.props.isFavorite=e}get isPtt(){return this.props.isPtt}set isPtt(e){this.props.isPtt=e}get name(){return this.props.name}set name(e){this.props.name=e}get metadata(){return{data:this.props.data,id:this.id,isFavorite:this.props.isFavorite,isPtt:this.props.isPtt,name:this.props.name}}static create(e,s){return new oe(e,s)}}const Ve={audioList:[],dummyTrigger:!1,filterTerm:"",selectedAudioId:""},Le="ZV:audioStore";class ht{constructor(e,s={shouldMigrate:!1}){o(this,"_store");o(this,"useDashboardAudioList",()=>f(this.store,e=>{const s=e.filterTerm,i=s.trim().length>0?e.audioList.filter(t=>b(t.name,{toLowerCase:!0}).includes(b(s,{toLowerCase:!0}))):e.audioList,n=e.selectedAudioId;return{filterTerm:s,filteredAudioList:i,selectedAudioId:n}}));o(this,"useGetAudioList",()=>f(this.store,e=>e.audioList));o(this,"useGetAudioCount",()=>f(this.store,e=>e.audioList.length));o(this,"useGetFilteredAudioList",()=>f(this.store,e=>e.audioList.filter(s=>b(s.name,{toLowerCase:!0}).includes(b(e.filterTerm,{toLowerCase:!0})))));o(this,"useGetHasAudios",()=>f(this.store,e=>e.audioList.length>0));o(this,"useGetFilterTerm",()=>f(this.store,e=>e.filterTerm));o(this,"useGetSelectedAudioId",()=>f(this.store,e=>({selectedAudioId:e.selectedAudioId,dummyTrigger:e.dummyTrigger})));o(this,"addAudio",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().addAudio(...e)));o(this,"deleteAudio",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().deleteAudio(...e)));o(this,"findById",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));o(this,"getAudioDataById",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().getAudioDataById(...e)));o(this,"reorderAudioList",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().reorderAudioList(...e)));o(this,"saveAudio",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().saveAudio(...e)));o(this,"selectAudio",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().selectAudio(...e)));o(this,"setAudioFilter",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().setAudioFilter(...e)));o(this,"toggleAudioIsFavorite",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().toggleAudioIsFavorite(...e)));this.zustandStorage=e,this.options=s,this._store=k()(O((i,n)=>({...Ve,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addAudio:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data,isPtt:t.isPtt}),i(a=>({audioList:[...a.audioList,{asViewOnce:!!t.asViewOnce,id:t.id.toString(),isFavorite:!!t.isFavorite,isPtt:t.isPtt,name:t.name}],filterTerm:"",selectedAudioId:t.id}))},deleteAudio:async t=>{i(a=>({audioList:a.audioList.filter(r=>r.id!==t),selectedAudioId:"",filterTerm:""})),await this.zustandStorage.removeItem(t)},findById:async t=>{const a=await this.getAudioDataById(t),r=n().audioList.find(u=>u.id===t);return r?oe.create({asViewOnce:r.asViewOnce,data:a?a.data:"",isFavorite:r.isFavorite,isPtt:r.isPtt,name:r.name},new P(t)):null},getAudioDataById:async t=>{let a=null;const r=await this.zustandStorage.getParsedItem(t),u=n().audioList.find(m=>m.id===t);return r&&u&&(a={...r,isPtt:u.isPtt}),a},reorderAudioList:async t=>{const{sourceIndex:a,destinationIndex:r}=t,u=n().audioList,m=u.splice(a,1);u.splice(r,0,...m),i({audioList:u,dummyTrigger:!n().dummyTrigger})},saveAudio:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data,isPtt:t.isPtt}),i(r=>({audioList:r.audioList.map(u=>{var m;if(u.id===t.id){const S=((m=t.name)==null?void 0:m.trim())??"";return{asViewOnce:t.asViewOnce??u.asViewOnce,id:t.id,isFavorite:t.isFavorite??u.isFavorite,isPtt:t.isPtt??u.isPtt,name:S===""?u.name:S}}return u})}));const a=n().selectedAudioId;a&&t.id===a&&n().toggleDummy()},selectAudio:async t=>i({selectedAudioId:t}),setAudioFilter:async t=>{i({filterTerm:t.trim()})},toggleAudioIsFavorite:async t=>{i(a=>({audioList:a.audioList.map(r=>r.id===t?{...r,isFavorite:!r.isFavorite}:r)}))}}),{name:Le,storage:$(()=>this.zustandStorage),version:0})),this.options.shouldMigrate&&this.validateAudioMigration(),this.zustandStorage.addStorageListener(async()=>{await this.rehydrateStore()},[Le])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300);try{JSON.parse(localStorage.getItem("ZV:cachedAudioIds")||"[]").forEach(s=>{localStorage.removeItem(s.id)}),localStorage.removeItem("ZV:cachedAudioIds")}catch{}}get store(){return this._store}get audioList(){return d.unstable_batchedUpdates(()=>this.store.getState().audioList)}get audioCount(){return d.unstable_batchedUpdates(()=>this.store.getState().audioList.length)}get filteredAudioList(){return d.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm;return this.store.getState().audioList.filter(i=>b(i.name,{toLowerCase:!0}).includes(b(e,{toLowerCase:!0})))})}get hasAudios(){return d.unstable_batchedUpdates(()=>this.store.getState().audioList.length>0)}get filterTerm(){return d.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get selectedAudioId(){return d.unstable_batchedUpdates(()=>this.store.getState().selectedAudioId)}async migrateFromOldSchema(e){this.store.setState({audioList:e.map(s=>({asViewOnce:!1,id:s.id,isFavorite:!1,isPtt:!0,name:s.name}))})}async validateAudioMigration(e=!1){const s="migratedAudioSchema",i=await this.zustandStorage.getParsedItem(s);if(i)return;const n="audiosIndex",t=this.store.getState().audioList;if(t.length>0&&e===!1)return;const r=await this.zustandStorage.getParsedItem(n);(!!(t.length===0&&r&&r.length>0)&&!i||e)&&(await this.migrateFromOldSchema(r??[]),await this.zustandStorage.setItem(s,"true")),e&&(e=!1)}}class de extends Z{get name(){return this.props.name}set name(e){this.props.name=e}get data(){return this.props.data}set data(e){this.props.data=e}get fileName(){return this.props.fileName}set fileName(e){this.props.fileName=e}get isFavorite(){return this.props.isFavorite}set isFavorite(e){this.props.isFavorite=e}get metadata(){return{id:this.id,name:this.props.name,data:this.props.data,fileName:this.props.fileName,isFavorite:this.props.isFavorite}}static create(e,s){return new de(e,s)}}const ze={documentList:[],dummyTrigger:!1,filterTerm:"",selectedDocumentId:""},Ie="ZV:documentStore",Ge="docsIndex";class gt{constructor(e,s={shouldMigrate:!1}){o(this,"_store");o(this,"useGetDocumentList",()=>f(this.store,e=>e.documentList));o(this,"useGetDocumentCount",()=>f(this.store,e=>e.documentList.length));o(this,"useGetFilteredDocumentList",()=>f(this.store,e=>e.documentList.filter(s=>b(s.name,{toLowerCase:!0}).includes(b(e.filterTerm,{toLowerCase:!0})))));o(this,"useGetHasDocuments",()=>f(this.store,e=>e.documentList.length>0));o(this,"useGetFilterTerm",()=>f(this.store,e=>e.filterTerm));o(this,"useGetSelectedDocument",()=>f(this.store,e=>({selectedDocumentId:e.selectedDocumentId,dummyTrigger:e.dummyTrigger})));o(this,"useDashboardDocumentList",()=>f(this.store,e=>{const s=e.filterTerm,i=s.trim().length>0?e.documentList.filter(t=>b(t.name,{toLowerCase:!0}).includes(b(s,{toLowerCase:!0}))):e.documentList,n=e.selectedDocumentId;return{filteredDocumentList:i,filterTerm:s,selectedDocumentId:n}}));o(this,"addDocument",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().addDocument(...e)));o(this,"deleteDocument",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().deleteDocument(...e)));o(this,"findById",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));o(this,"getDocumentDataById",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().getDocumentDataById(...e)));o(this,"reorderDocumentList",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().reorderDocumentList(...e)));o(this,"saveDocument",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().saveDocument(...e)));o(this,"selectDocument",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().selectDocument(...e)));o(this,"setDocumentFilter",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().setDocumentFilter(...e)));o(this,"toggleDocumentIsFavorite",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().toggleDocumentIsFavorite(...e)));this.zustandStorage=e,this.options=s,this._store=k()(O((i,n)=>({...ze,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addDocument:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data,fileName:t.fileName}),i(a=>({documentList:[...a.documentList,{id:t.id.toString(),isFavorite:t.isFavorite,name:t.name}],filterTerm:"",selectedDocumentId:t.id}))},deleteDocument:async t=>{i(a=>({documentList:a.documentList.filter(r=>r.id!==t),selectedDocumentId:"",filterTerm:""})),await this.zustandStorage.removeItem(t)},findById:async t=>{const a=await this.getDocumentDataById(t),r=n().documentList.find(u=>u.id===t);return r&&(a||a==="")?de.create({data:a.data,fileName:a.fileName,isFavorite:r.isFavorite,name:r.name},new P(t)):null},getDocumentDataById:async t=>{let a=null;const r=await this.zustandStorage.getParsedItem(t);return typeof(r==null?void 0:r.data)=="string"&&typeof r.fileName=="string"&&(a=r),a},reorderDocumentList:async t=>{const{sourceIndex:a,destinationIndex:r}=t,u=n().documentList,m=u.splice(a,1);u.splice(r,0,...m),i({documentList:u})},saveDocument:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data,fileName:t.fileName}),i(r=>({documentList:r.documentList.map(u=>{var m;if(u.id===t.id){const S=((m=t.name)==null?void 0:m.trim())??"";return{id:t.id,isFavorite:t.isFavorite??u.isFavorite,name:S===""?u.name:S}}return u})}));const a=n().selectedDocumentId;a&&t.id===a&&n().toggleDummy()},selectDocument:async t=>i({selectedDocumentId:t}),setDocumentFilter:async t=>{i({filterTerm:t.trim()})},toggleDocumentIsFavorite:async t=>{i(a=>({documentList:a.documentList.map(r=>r.id===t?{...r,isFavorite:!r.isFavorite}:r)}))}}),{name:Ie,storage:$(()=>this.zustandStorage),version:0})),this.options.shouldMigrate&&this.validateDocumentMigration(),this.zustandStorage.addStorageListener(async()=>{await this.rehydrateStore()},[Ie])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300);try{JSON.parse(localStorage.getItem("ZV:cachedDocumentIds")||"[]").forEach(s=>{localStorage.removeItem(s.id)}),localStorage.removeItem("ZV:cachedDocumentIds")}catch{}}get store(){return this._store}get documentList(){return d.unstable_batchedUpdates(()=>this.store.getState().documentList)}get documentCount(){return d.unstable_batchedUpdates(()=>this.store.getState().documentList.length)}get filteredDocumentList(){return d.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm,s=this.store.getState().documentList;return e?s.filter(i=>b(i.name,{toLowerCase:!0}).includes(b(e,{toLowerCase:!0}))):s})}get hasDocuments(){return d.unstable_batchedUpdates(()=>this.store.getState().documentList.length>0)}get filterTerm(){return d.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get selectedDocument(){return d.unstable_batchedUpdates(()=>this.store.getState().selectedDocumentId)}async migrateFromOldSchema(e){this.store.setState({documentList:e.map(s=>({id:s.id,name:s.name,isFavorite:!1}))})}async validateDocumentMigration(e=!1){const s="migratedDocsSchema",i=await this.zustandStorage.getParsedItem(s);if(i)return;const n=this._store.getState().documentList;if(n.length>0&&e===!1)return;const a=await this.zustandStorage.getParsedItem(Ge);(!!(n.length===0&&a&&a.length>0)&&!i||e)&&(await this.zustandStorage.setItem(s,"true"),await this.migrateFromOldSchema(a??[])),e&&(e=!1)}}class ae extends Z{get funnelId(){return this.props.funnelId}get id(){return this.props.id}get itemId(){return this.props.itemId}get delayBeforeSend(){return this.props.delayBeforeSend}get type(){return this.props.type}get metadata(){return{delayBeforeSend:this.delayBeforeSend,funnelId:this.funnelId,id:this.id,itemId:this.itemId,type:this.type}}}class ue extends ae{static create(e,s){return new ue({...e,type:"audio"},s)}}class ce extends ae{static create(e,s){return new ce({...e,type:"document"},s)}}class le extends ae{static create(e,s){return new le({...e,type:"media"},s)}}class he extends ae{static create(e,s){return new he({...e,type:"message"},s)}}const Re={dummyTrigger:!1,filterTerm:"",funnelList:[],selectedFunnelId:""},He="funis",be="ZV:funnelStore";class mt{constructor(e,s={shouldMigrate:!1}){o(this,"_store");o(this,"useGetFunnelList",()=>f(this.store,e=>e.funnelList));o(this,"useDashboardFunnelList",()=>f(this.store,e=>{const s=e.filterTerm,i=s.trim().length>0?e.funnelList.filter(t=>b(t.name,{toLowerCase:!0}).includes(b(e.filterTerm,{toLowerCase:!0}))):e.funnelList,n=e.selectedFunnelId;return{filteredFunnelList:i,filterTerm:s,selectedFunnelId:n}}));o(this,"useGetFunnelCount",()=>f(this.store,e=>e.funnelList.length));o(this,"useGetFilteredFunnelList",()=>f(this.store,e=>e.funnelList.filter(s=>b(s.name,{toLowerCase:!0}).includes(b(e.filterTerm,{toLowerCase:!0})))));o(this,"useGetHasFunnels",()=>f(this.store,e=>e.funnelList.length>0));o(this,"useGetFilterTerm",()=>f(this.store,e=>e.filterTerm));o(this,"useGetSelectedFunnel",()=>f(this.store,e=>({selectedFunnelId:e.selectedFunnelId,dummyTrigger:e.dummyTrigger})));this.zustandStorage=e,this.options=s,this._store=k()(O((i,n)=>({...Re,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addFunnel:async t=>{i(a=>({funnelList:[...a.funnelList,{id:t.id,isFavorite:!!t.isFavorite,name:t.name,itemsSequence:t.itemsSequence}],filterTerm:"",selectedFunnelId:t.id}))},deleteFunnel:async t=>{i(a=>({funnelList:a.funnelList.filter(r=>r.id!==t),selectedFunnelId:"",filterTerm:""}))},findById:async t=>n().funnelList.find(a=>a.id===t)??null,findFunnelsWithItem:async t=>n().funnelList.filter(a=>a.itemsSequence.some(r=>r.itemId===t)).map(a=>a.name),getSequenceItems:async(t,a)=>{const r=await n().findById(t);return r?r.itemsSequence.slice(a,r.itemsSequence.length):[]},reorderFunnelList:async t=>{const{sourceIndex:a,destinationIndex:r}=t,u=n().funnelList,m=u.splice(a,1);u.splice(r,0,...m),i({funnelList:u})},saveFunnel:async t=>{i(r=>({funnelList:r.funnelList.map(u=>{var m;if(u.id===t.id){const S=((m=t.name)==null?void 0:m.trim())??"";return{id:t.id,isFavorite:t.isFavorite??u.isFavorite,name:S===""?u.name:S,itemsSequence:t.itemsSequence??u.itemsSequence}}return u})}));const a=n().selectedFunnelId;a&&t.id===a&&n().toggleDummy()},selectFunnel:async t=>i({selectedFunnelId:t}),setFunnelFilter:async t=>{i({filterTerm:t.trim()})}}),{name:be,storage:$(()=>e),version:0})),this.options.shouldMigrate&&this.validateFunnelMigration(),e.addStorageListener(async()=>{await this.rehydrateStore()},[be])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300)}get store(){return this._store}get funnelList(){return d.unstable_batchedUpdates(()=>this.store.getState().funnelList)}get funnelCount(){return d.unstable_batchedUpdates(()=>this.store.getState().funnelList.length)}get filterTerm(){return d.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get filteredFunnelList(){return d.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm,s=this.store.getState().funnelList;return e?s.filter(i=>b(i.name,{toLowerCase:!0}).includes(b(e,{toLowerCase:!0}))):s})}get hasFunnels(){return d.unstable_batchedUpdates(()=>this.store.getState().funnelList.length>0)}get selectedFunnel(){return d.unstable_batchedUpdates(()=>this.store.getState().selectedFunnelId)}addFunnel(...e){return d.unstable_batchedUpdates(()=>this.store.getState().addFunnel(...e))}deleteFunnel(...e){return d.unstable_batchedUpdates(()=>this.store.getState().deleteFunnel(...e))}findById(...e){return d.unstable_batchedUpdates(()=>this.store.getState().findById(...e))}findFunnelsWithItem(...e){return d.unstable_batchedUpdates(()=>this.store.getState().findFunnelsWithItem(...e))}getSequenceItems(...e){return d.unstable_batchedUpdates(()=>this.store.getState().getSequenceItems(...e))}reorderFunnelList(...e){return d.unstable_batchedUpdates(()=>this.store.getState().reorderFunnelList(...e))}saveFunnel(...e){return d.unstable_batchedUpdates(async()=>this.store.getState().saveFunnel(...e))}selectFunnel(...e){return d.unstable_batchedUpdates(()=>this.store.getState().selectFunnel(...e))}setFunnelFilter(...e){return d.unstable_batchedUpdates(()=>this.store.getState().setFunnelFilter(...e))}migrateOldFunnelItem(e,s){switch(s.type){case"medias":return le.create({id:new P().toString(),itemId:s.id,funnelId:e,delayBeforeSend:s.delay}).metadata;case"audios":return ue.create({id:new P().toString(),itemId:s.id,funnelId:e,delayBeforeSend:s.delay}).metadata;case"docs":return ce.create({id:new P().toString(),itemId:s.id,funnelId:e,delayBeforeSend:s.delay}).metadata;case"mensagens":return he.create({id:new P().toString(),itemId:s.id,funnelId:e,delayBeforeSend:s.delay}).metadata}}async migrateFromOldSchema(e){this.store.setState({funnelList:e.map(s=>{var i;return{id:s.id,name:s.name,itemsSequence:((i=s.data)==null?void 0:i.map(n=>this.migrateOldFunnelItem(s.id,n)))??[],isFavorite:!1}})})}async validateFunnelMigration(e=!1){const s="migratedFunnelSchema",i=await this.zustandStorage.getParsedItem(s);if(i)return;const n=this.store.getState().funnelList;if(n.length>0&&e===!1)return;const a=await this.zustandStorage.getParsedItem(He);(!!(n.length===0&&a&&a.length>0)&&!i||e)&&(await this.zustandStorage.setItem(s,"true"),await this.migrateFromOldSchema(a??[])),e&&(e=!1)}}class ge extends Z{get caption(){return this.props.caption}set caption(e){this.props.caption=e}get data(){return this.props.data}set data(e){this.props.data=e}get isFavorite(){return this.props.isFavorite}set isFavorite(e){this.props.isFavorite=e}get name(){return this.props.name}set name(e){this.props.name=e}get asViewOnce(){return this.props.asViewOnce}set asViewOnce(e){this.props.asViewOnce=e}get metadata(){return{caption:this.props.caption,data:this.props.data,id:this.id,isFavorite:this.props.isFavorite,name:this.props.name}}static create(e,s){return new ge(e,s)}}const We={dummyTrigger:!1,filterTerm:"",mediaList:[],selectedMediaId:""},Te="ZV:mediaStore";class pt{constructor(e,s={shouldMigrate:!1}){o(this,"_store");o(this,"useDashboardMediaList",()=>f(this.store,e=>{const s=e.filterTerm,i=s.trim().length>0?e.mediaList.filter(t=>b(t.name,{toLowerCase:!0}).includes(b(s,{toLowerCase:!0}))):e.mediaList,n=e.selectedMediaId;return{filteredMediaList:i,filterTerm:s,selectedMediaId:n}}));o(this,"useGetMediaList",()=>f(this.store,e=>e.mediaList));o(this,"useGetMediaCount",()=>f(this.store,e=>e.mediaList.length));o(this,"useGetFilteredMediaList",()=>f(this.store,e=>e.mediaList.filter(s=>b(s.name,{toLowerCase:!0}).includes(b(e.filterTerm,{toLowerCase:!0})))));o(this,"useGetHasMedias",()=>f(this.store,e=>e.mediaList.length>0));o(this,"useGetFilterTerm",()=>f(this.store,e=>e.filterTerm));o(this,"useGetSelectedMedia",()=>f(this.store,e=>({selectedMediaId:e.selectedMediaId,dummyTrigger:e.dummyTrigger})));o(this,"addMedia",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().addMedia(...e)));o(this,"deleteMedia",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().deleteMedia(...e)));o(this,"findById",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));o(this,"getMediaDataById",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().getMediaDataById(...e)));o(this,"reorderMediaList",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().reorderMediaList(...e)));o(this,"saveMedia",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().saveMedia(...e)));o(this,"selectMedia",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().selectMedia(...e)));o(this,"setMediaFilter",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().setMediaFilter(...e)));o(this,"toggleMediaIsFavorite",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().toggleMediaIsFavorite(...e)));this.zustandStorage=e,this.options=s,this._store=k()(O((i,n)=>({...We,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addMedia:async t=>{await this.zustandStorage.setItem(t.id,{caption:t.caption,data:t.data}),i(a=>({mediaList:[...a.mediaList,{id:t.id.toString(),isFavorite:!!t.isFavorite,name:t.name,asViewOnce:!!t.asViewOnce}],filterTerm:"",selectedMediaId:t.id}))},deleteMedia:async t=>{i(a=>({mediaList:a.mediaList.filter(r=>r.id!==t),selectedMediaId:"",filterTerm:""})),await this.zustandStorage.removeItem(t)},findById:async t=>{const a=await this.getMediaDataById(t),r=n().mediaList.find(u=>u.id===t);return a!=null&&a.data&&r?ge.create({caption:a.caption,data:a.data,isFavorite:r.isFavorite,name:r.name,asViewOnce:r.asViewOnce},new P(t)):null},getMediaDataById:async t=>{let a=null;const r=await this.zustandStorage.getParsedItem(t);return r&&(a={caption:r.caption??"",data:r.data??""}),a},reorderMediaList:async t=>{const{sourceIndex:a,destinationIndex:r}=t,u=n().mediaList,m=u.splice(a,1);u.splice(r,0,...m),i({mediaList:u})},saveMedia:async t=>{await this.zustandStorage.setItem(t.id,{caption:t.caption,data:t.data}),i(r=>({mediaList:r.mediaList.map(u=>{var m;if(u.id===t.id){const S=((m=t.name)==null?void 0:m.trim())??"";return{id:t.id,isFavorite:t.isFavorite??u.isFavorite,name:S===""?u.name:S,asViewOnce:t.asViewOnce??u.asViewOnce}}return u})}));const a=n().selectedMediaId;a&&t.id===a&&n().toggleDummy()},selectMedia:async t=>{i({selectedMediaId:t})},setMediaFilter:async t=>{i({filterTerm:t.trim()})},toggleMediaIsFavorite:async t=>{i(a=>({mediaList:a.mediaList.map(r=>r.id===t?{...r,isFavorite:!r.isFavorite}:r)}))}}),{name:Te,storage:$(()=>e),version:0})),this.options.shouldMigrate&&this.validateMediaMigration(),e.addStorageListener(async()=>{await this.rehydrateStore()},[Te])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300);try{JSON.parse(localStorage.getItem("ZV:cachedMediaIds")||"[]").forEach(s=>{localStorage.removeItem(s.id)}),localStorage.removeItem("ZV:cachedMediaIds")}catch{}}get store(){return this._store}get mediaList(){return d.unstable_batchedUpdates(()=>this.store.getState().mediaList)}get mediaCount(){return d.unstable_batchedUpdates(()=>this.store.getState().mediaList.length)}get filteredmediaList(){return d.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm;return this.store.getState().mediaList.filter(i=>b(i.name,{toLowerCase:!0}).includes(b(e,{toLowerCase:!0})))})}get hasMedias(){return d.unstable_batchedUpdates(()=>this.store.getState().mediaList.length>0)}get filterTerm(){return d.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get selectedMedia(){return d.unstable_batchedUpdates(()=>this.store.getState().selectedMediaId)}async migrateFromOldSchema(e){this.store.setState({mediaList:e.map(s=>({id:s.id.toString(),isFavorite:!1,name:s.name,asViewOnce:!1}))})}async validateMediaMigration(e=!1){const s="migratedMediaSchema",i=await this.zustandStorage.getParsedItem(s);if(i)return;const n="mediasIndex",t=this._store.getState().mediaList;if(t.length>0&&e===!1)return;const r=await this.zustandStorage.getParsedItem(n);(!!(t.length===0&&r&&r.length>0)&&!i||e)&&(await this.zustandStorage.setItem(s,"true"),await this.migrateFromOldSchema(r??[])),e&&(e=!1)}}class me extends Z{get name(){return this.props.name}set name(e){this.props.name=e}get data(){return this.props.data}set data(e){this.props.data=e}get isFavorite(){return this.props.isFavorite}set isFavorite(e){this.props.isFavorite=e}get metadata(){return{id:this.id,name:this.props.name,data:this.props.data,isFavorite:this.props.isFavorite}}static create(e,s){return new me(e,s)}}const Ze={dummyTrigger:!1,filterTerm:"",selectedTextMessageId:"",textMessageList:[]},Me="ZV:textMessageStore",qe="mensagensIndex";class ft{constructor(e,s={shouldMigrate:!1}){o(this,"_store");o(this,"useDashboardTextMessageList",()=>f(this.store,e=>{const s=e.filterTerm,i=s.trim().length>0?e.textMessageList.filter(t=>b(t.name,{toLowerCase:!0}).includes(b(s,{toLowerCase:!0}))):e.textMessageList,n=e.selectedTextMessageId;return{filteredTextMessageList:i,filterTerm:s,selectedTextMessageId:n}}));o(this,"useGetTextMessageList",()=>f(this.store,e=>e.textMessageList));o(this,"useGetTextMessageCount",()=>f(this.store,e=>e.textMessageList.length));o(this,"useGetFilteredTextMessageList",()=>f(this.store,e=>e.textMessageList.filter(s=>b(s.name,{toLowerCase:!0}).includes(b(e.filterTerm,{toLowerCase:!0})))));o(this,"useGetHasTextMessages",()=>f(this.store,e=>e.textMessageList.length>0));o(this,"useGetFilterTerm",()=>f(this.store,e=>e.filterTerm));o(this,"useGetSelectedTextMessage",()=>f(this.store,e=>({selectedTextMessageId:e.selectedTextMessageId,dummyTrigger:e.dummyTrigger})));o(this,"addTextMessage",e=>d.unstable_batchedUpdates(()=>this.store.getState().addTextMessage(e)));o(this,"deleteTextMessage",e=>d.unstable_batchedUpdates(()=>this.store.getState().deleteTextMessage(e)));o(this,"findById",e=>d.unstable_batchedUpdates(()=>this.store.getState().findById(e)));o(this,"getTextMessageDataById",e=>d.unstable_batchedUpdates(()=>this.store.getState().getTextMessageDataById(e)));o(this,"reorderTextMessageList",e=>d.unstable_batchedUpdates(()=>this.store.getState().reorderTextMessageList(e)));o(this,"saveTextMessage",e=>d.unstable_batchedUpdates(async()=>this.store.getState().saveTextMessage(e)));o(this,"selectTextMessage",e=>d.unstable_batchedUpdates(()=>this.store.getState().selectTextMessage(e)));o(this,"setTextMessageFilter",e=>d.unstable_batchedUpdates(()=>this.store.getState().setTextMessageFilter(e)));o(this,"toggleTextMessageIsFavorite",e=>d.unstable_batchedUpdates(async()=>this.store.getState().toggleTextMessageIsFavorite(e)));this.zustandStorage=e,this.options=s,this._store=k()(O((i,n)=>({...Ze,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addTextMessage:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data}),i(a=>({textMessageList:[...a.textMessageList,{id:t.id.toString(),isFavorite:t.isFavorite,name:t.name}],filterTerm:"",selectedTextMessageId:t.id}))},deleteTextMessage:async t=>{i(a=>({textMessageList:a.textMessageList.filter(r=>r.id!==t),selectedTextMessageId:"",filterTerm:""})),await this.zustandStorage.removeItem(t)},findById:async t=>{const a=await this.getTextMessageDataById(t),r=n().textMessageList.find(u=>u.id===t);return r&&(a!=null&&a.data||(a==null?void 0:a.data)==="")?me.create({data:a.data,isFavorite:r.isFavorite,name:r.name},new P(t)):null},getTextMessageDataById:async t=>{let a=null;const r=await this.zustandStorage.getParsedItem(t);return typeof(r==null?void 0:r.data)=="string"&&(a={data:r.data}),a},reorderTextMessageList:async t=>{const{sourceIndex:a,destinationIndex:r}=t,u=n().textMessageList,m=u.splice(a,1);u.splice(r,0,...m),i({textMessageList:u})},saveTextMessage:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data}),i(r=>({textMessageList:r.textMessageList.map(u=>{var m;if(u.id===t.id){const S=((m=t.name)==null?void 0:m.trim())??"";return{id:t.id,isFavorite:t.isFavorite??u.isFavorite,name:S===""?u.name:S}}return u})}));const a=n().selectedTextMessageId;a&&t.id===a&&n().toggleDummy()},selectTextMessage:async t=>i({selectedTextMessageId:t}),setTextMessageFilter:async t=>{i({filterTerm:t.trim()})},toggleTextMessageIsFavorite:async t=>{i(a=>({textMessageList:a.textMessageList.map(r=>r.id===t?{...r,isFavorite:!r.isFavorite}:r)}))}}),{name:Me,storage:$(()=>e),version:0})),this.options.shouldMigrate&&this.validateTextMessageMigration(),e.addStorageListener(async()=>{await this.rehydrateStore()},[Me])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300);try{JSON.parse(localStorage.getItem("ZV:cachedTextMessageIds")||"[]").forEach(s=>{localStorage.removeItem(s.id)}),localStorage.removeItem("ZV:cachedTextMessageIds")}catch{}}get store(){return this._store}get textMessageList(){return d.unstable_batchedUpdates(()=>this.store.getState().textMessageList)}get textMessageCount(){return d.unstable_batchedUpdates(()=>this.store.getState().textMessageList.length)}get filteredTextMessageList(){return d.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm;return this.store.getState().textMessageList.filter(i=>b(i.name,{toLowerCase:!0}).includes(b(e,{toLowerCase:!0})))})}get hasTextMessages(){return d.unstable_batchedUpdates(()=>this.store.getState().textMessageList.length>0)}get filterTerm(){return d.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get selectedTextMessage(){return d.unstable_batchedUpdates(()=>this.store.getState().selectedTextMessageId)}async migrateFromOldSchema(e){this.store.setState({textMessageList:e.map(s=>({id:s.id,name:s.name,isFavorite:!1}))})}async validateTextMessageMigration(e=!1){const s="migratedMessageSchema",i=await this.zustandStorage.getParsedItem(s);if(i)return;const n=this.store.getState().textMessageList;if(n.length>0&&e===!1)return;const a=await this.zustandStorage.getParsedItem(qe);(!!(n.length===0&&a&&a.length>0)&&!i||e)&&(await this.zustandStorage.setItem(s,"true"),await this.migrateFromOldSchema(a??[])),e&&(e=!1)}}class pe extends Z{get createdAt(){return this.props.createdAt}get endTimeInMs(){return this.props.endTimeInMs}get funnelData(){return this.props.funnelData}get isBulkItem(){return this.props.isBulkItem}get isPtt(){return this.props.isPtt}get itemId(){return this.props.itemId}get itemName(){return this.props.itemName}get scheduleDate(){return this.props.scheduleDate}get scheduledByUser(){return this.props.scheduledByUser}get sentAt(){return this.props.sentAt}get simulationDelay(){return this.props.simulationDelay}get startTimeInMs(){return this.props.startTimeInMs}get status(){return this.props.status}get targetChatId(){return this.props.targetChatId}get targetChatName(){return this.props.targetChatName}get type(){return this.props.type}get uuidCode(){return this.props.uuidCode}static create(e,s){return new pe({...e,isPtt:e.isPtt??null},s)}}const Ke={dummyTrigger:!1,scheduleList:[]},je="ZV:scheduleStore";class St{constructor(e){o(this,"_store");o(this,"useGetHasSchedules",()=>f(this.store,e=>e.scheduleList.length>0));o(this,"useGetScheduleList",()=>f(this.store,e=>e.scheduleList));o(this,"addSchedule",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().addSchedule(...e)));o(this,"changeSchedulesStatus",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().changeSchedulesStatus(...e)));o(this,"deleteManySchedules",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().deleteManySchedules(...e)));o(this,"deleteSchedule",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().deleteSchedule(...e)));o(this,"findById",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));o(this,"findManySchedules",()=>d.unstable_batchedUpdates(()=>this.store.getState().findManySchedules()));o(this,"findManyByStatus",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().findManyByStatus(...e)));o(this,"getScheduledByChatId",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().getScheduledByChatId(...e)));o(this,"getScheduledFunnelByFunnelId",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().getScheduledFunnelByFunnelId(...e)));o(this,"markScheduleAsSent",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().markScheduleAsSent(...e)));o(this,"removeAutoScheduledItems",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().removeAutoScheduledItems(...e)));o(this,"removeSentScheduledItems",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().removeSentScheduledItems(...e)));o(this,"removeScheduledItemByChatAndUuidCode",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().removeScheduledItemByChatAndUuidCode(...e)));this.zustandStorage=e,this._store=k()(O((s,i)=>({...Ke,toggleDummy:()=>s(n=>({dummyTrigger:!n.dummyTrigger})),addSchedule:async n=>{s(t=>({scheduleList:[...t.scheduleList,{createdAt:n.createdAt,endTimeInMs:n.endTimeInMs,funnelData:n.funnelData,id:n.id,isBulkItem:n.isBulkItem,isPtt:n.isPtt,itemId:n.itemId,itemName:n.itemName,scheduleDate:n.scheduleDate,scheduledByUser:n.scheduledByUser,sentAt:n.sentAt,simulationDelay:n.simulationDelay,startTimeInMs:n.startTimeInMs,status:n.status,targetChatId:n.targetChatId,targetChatName:n.targetChatName,type:n.type,uuidCode:n.uuidCode}]}))},changeSchedulesStatus:async n=>{s(t=>({scheduleList:t.scheduleList.map(a=>{var u;const r=(u=n.find(m=>m.scheduleId===a.id))==null?void 0:u.status;return r?{...a,status:r??a.status,sentAt:r==="sent"?new Date:null}:a})}))},deleteManySchedules:async n=>{s(t=>({scheduleList:t.scheduleList.filter(a=>!n.includes(a.id))}))},deleteSchedule:async n=>{s(t=>({scheduleList:t.scheduleList.filter(a=>a.id!==n)}))},findById:async n=>{const t=i().scheduleList.find(a=>a.id===n);return t?pe.create({createdAt:t.createdAt,endTimeInMs:t.endTimeInMs,funnelData:t.funnelData,id:t.id,itemId:t.itemId,itemName:t.itemName,scheduleDate:t.scheduleDate,sentAt:t.sentAt,simulationDelay:t.simulationDelay,startTimeInMs:t.startTimeInMs,status:t.status,targetChatId:t.targetChatId,targetChatName:t.targetChatName,type:t.type,uuidCode:t.uuidCode},new P(n)):null},findManyByStatus:async n=>i().scheduleList.filter(a=>a.status===n),findManySchedules:async()=>{const n=new Date().getTime();return i().scheduleList.filter(a=>{const u=new Date(a.scheduleDate).getTime()<=n,m=a.status==="scheduled",S=a.status==="pending";return u&&(m||S)})},getScheduledByChatId:async(n,t)=>{const a=i().scheduleList.filter(u=>u.targetChatId===n&&(!t||t===u.type)),r={};for(const u of a)Object.keys(r).indexOf(u.uuidCode)===-1&&(r[u.uuidCode]=[]),r[u.uuidCode].push(u);return r},getScheduledFunnelByFunnelId:async(n,t)=>i().scheduleList.find(r=>{var u;return r.targetChatId===n&&(r.status==="scheduled"||r.status==="pending")&&((u=r.funnelData)==null?void 0:u.funnelId)===t}),markScheduleAsSent:async({scheduleId:n})=>{await this.changeSchedulesStatus([{scheduleId:n,status:"sent"}])},removeAutoScheduledItems:async()=>{s({scheduleList:i().scheduleList.filter(n=>n.scheduledByUser)})},removeScheduledItemByChatAndUuidCode:async(n,t)=>{const a=i().scheduleList.filter(r=>r.targetChatId===n&&r.uuidCode===t).map(r=>r.id);for(const r of a)await i().deleteSchedule(r)},removeSentScheduledItems:async()=>{const n=i().scheduleList.filter(t=>t.status==="sent").map(t=>t.id);for(const t of n)await i().deleteSchedule(t)}}),{name:je,storage:$(()=>this.zustandStorage),version:0}))}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300)}get store(){return this._store}get hasSchedules(){return d.unstable_batchedUpdates(()=>this.store.getState().scheduleList.length>0)}get scheduleList(){return d.unstable_batchedUpdates(()=>this.store.getState().scheduleList)}}const Ye=(c,e,s)=>c.filter(i=>i.isEnabled).filter(i=>i.keywordRules.length>0).filter(i=>!(i.sendToContacts===!1&&s)).filter(i=>!(i.sendToGroups===!1&&e));function Je(c){return c.replace(/[-[\]{}()*+?.\\^$|#]/g,"\\$&")}const Xe=c=>new RegExp(`\\b(?:\\s|\\p{P})*${Je(c)}(?:\\p{P})*`,"u"),_e=(c,e,s)=>{const i=b(s,{toLowerCase:!e}),n=c.keywords.map(a=>b(a,{toLowerCase:!e})),t=()=>{try{return n.some(a=>Xe(a).test(i))}catch(a){const r="Invalid regular expression: ";if(a instanceof SyntaxError&&a.message.startsWith(r)){const[u,...m]=a.message.replace(r,"").split(" ").map(S=>S.trim());console.error({errorName:r.replace(": ",""),regexError:m.join(" "),regexTerm:u.replace(/:$/,"")})}else a instanceof Error?console.error(a.toString()):console.error(JSON.stringify(a));return n.some(u=>u.includes(i))}};switch(c.type){case"startsWith":return n.some(a=>i.startsWith(a));case"contains":return t();case"equals":return n.some(a=>i===a);case"notContains":return!t();default:return!1}},Qe=(c,e,s)=>{const i=c.find(n=>n.type==="equals");return i?_e(i,e,s):c.every(n=>_e(n,e,s))},et={dummyTrigger:!1,filterTerm:"",selectedTriggerId:"",triggerList:[]},we="ZV:triggerStore";class yt{constructor(e,s={shouldMigrate:!1}){o(this,"_store");o(this,"useDashboardTriggerList",()=>f(this.store,e=>{const s=e.filterTerm,i=s.trim().length>0?e.triggerList.filter(t=>b(t.name,{toLowerCase:!0}).includes(b(s,{toLowerCase:!0}))):e.triggerList,n=e.selectedTriggerId;return{filteredTriggerList:i,filterTerm:s,selectedTriggerId:n}}));o(this,"useGetTriggerList",()=>f(this.store,e=>e.triggerList));o(this,"useGetTriggerCount",()=>f(this.store,e=>e.triggerList.length));o(this,"useGetFilteredTriggerList",()=>f(this.store,e=>e.triggerList.filter(s=>b(s.name,{toLowerCase:!0}).includes(b(e.filterTerm,{toLowerCase:!0})))));o(this,"useGetHasTriggers",()=>f(this.store,e=>e.triggerList.length>0));o(this,"useGetFilterTerm",()=>f(this.store,e=>e.filterTerm));o(this,"useGetSelectedTrigger",()=>f(this.store,e=>({selectedTriggerId:e.selectedTriggerId,dummyTrigger:e.dummyTrigger})));o(this,"add",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().add(...e)));o(this,"checkNewMessage",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().checkNewMessage(...e)));o(this,"delete",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().delete(...e)));o(this,"findById",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));o(this,"findMany",()=>d.unstable_batchedUpdates(()=>this.store.getState().findMany()));o(this,"reorderList",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().reorderList(...e)));o(this,"save",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().save(...e)));o(this,"select",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().select(...e)));o(this,"setFilter",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().setFilter(...e)));this.zustandStorage=e,this.options=s,this._store=k()(O((i,n)=>({...et,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),add:async t=>{i(a=>({triggerList:[...a.triggerList,{...t.metadata,keywordRules:t.keywordRules.map(r=>({...r,keywords:r.keywords.map(u=>u.trim())}))}],filterTerm:"",selectedTriggerId:t.id}))},checkNewMessage:async({isGroup:t,isMyContact:a,messageContents:r})=>{const u=Ye(n().triggerList,t,a);for(const m of u)if(Qe(m.keywordRules,m.isCaseSensitive,r))return m;return null},delete:async t=>{i(a=>({triggerList:a.triggerList.filter(r=>r.id!==t),selectedTriggerId:"",filterTerm:""}))},findById:async t=>n().triggerList.find(r=>r.id===t)??null,findMany:async()=>n().triggerList,reorderList:async t=>{const{sourceIndex:a,destinationIndex:r}=t,u=n().triggerList,m=u.splice(a,1);u.splice(r,0,...m),i({triggerList:u})},save:async t=>{i(r=>({triggerList:r.triggerList.map(u=>u.id===t.id?{...u,...t}:u)}));const a=n().selectedTriggerId;a&&t.id===a&&n().toggleDummy()},select:async t=>i({selectedTriggerId:t}),setFilter:async t=>{i({filterTerm:t.trim()})}}),{name:we,storage:$(()=>e),version:0})),this.options.shouldMigrate&&this.validateMigration(),e.addStorageListener(async()=>{await this.rehydrateStore()},[we])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300)}get store(){return this._store}get filteredList(){return d.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm;return this.store.getState().triggerList.filter(i=>b(i.name,{toLowerCase:!0}).includes(b(e,{toLowerCase:!0})))})}get filterTerm(){return d.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get hasTriggers(){return d.unstable_batchedUpdates(()=>this.store.getState().triggerList.length>0)}get selectedTrigger(){return d.unstable_batchedUpdates(()=>this.store.getState().selectedTriggerId)}get triggerList(){return d.unstable_batchedUpdates(()=>this.store.getState().triggerList)}get triggerCount(){return d.unstable_batchedUpdates(()=>this.store.getState().triggerList.length)}migrateOldKeywordRuleType(e){switch(e){case"equals":return"equals";case"contains":return"contains";case"starts":return"startsWith";case"not_contains":return"notContains"}}migrateOldKeywordRules(e){return e.map(s=>({id:s.id,keywords:s.keywords.map(i=>i.trim()),type:this.migrateOldKeywordRuleType(s.type)}))}async migrateFromOldSchema(e){this.store.setState({triggerList:e.map(s=>({id:s.id.toString(),name:s.name,isFavorite:!1,funnelId:s.funnelId??null,isCaseSensitive:!s.ignoreCaseSensitive,isEnabled:!!s.enabled,keywordRules:this.migrateOldKeywordRules(s.keywordRules),millisecondsBeforeSend:(s.secondsBeforeSend??0)*1e3,sendToContacts:!s.dontSendToContact,sendToGroups:!s.dontSendToGroups,triggeredAt:null,webhook:""}))})}async validateMigration(e=!1){const s="migratedTriggerSchema",i=await this.zustandStorage.getParsedItem(s);if(i)return;const n="triggers",t=this.store.getState().triggerList;if(t.length>0&&e===!1)return;const r=await this.zustandStorage.getParsedItem(n);(!!(t.length===0&&r&&r.length>0)&&!i||e)&&(await this.zustandStorage.setItem(s,"true"),await this.migrateFromOldSchema(r??[])),e&&(e=!1)}}function ve(c){return c.split("").reverse().join("")}function Lt(c){if(typeof c!="string")return c;const e=ve(c),s=atob(e);return ve(s)}var Ae={exports:{}};(function(c,e){(function(s,i){c.exports=i()})(Ce,function(){var s=1e3,i=6e4,n=36e5,t="millisecond",a="second",r="minute",u="hour",m="day",S="week",w="month",v="quarter",A="year",B="date",x="Invalid Date",X=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,q=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,K={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(y){var g=["th","st","nd","rd"],l=y%100;return"["+y+(g[(l-20)%10]||g[l]||g[0])+"]"}},ie=function(y,g,l){var p=String(y);return!p||p.length>=g?y:""+Array(g+1-p.length).join(l)+y},xe={s:ie,z:function(y){var g=-y.utcOffset(),l=Math.abs(g),p=Math.floor(l/60),h=l%60;return(g<=0?"+":"-")+ie(p,2,"0")+":"+ie(h,2,"0")},m:function y(g,l){if(g.date()<l.date())return-y(l,g);var p=12*(l.year()-g.year())+(l.month()-g.month()),h=g.clone().add(p,w),L=l-h<0,I=g.clone().add(p+(L?-1:1),w);return+(-(p+(l-h)/(L?h-I:I-h))||0)},a:function(y){return y<0?Math.ceil(y)||0:Math.floor(y)},p:function(y){return{M:w,y:A,w:S,d:m,D:B,h:u,m:r,s:a,ms:t,Q:v}[y]||String(y||"").toLowerCase().replace(/s$/,"")},u:function(y){return y===void 0}},j="en",z={};z[j]=K;var fe="$isDayjsObject",ne=function(y){return y instanceof ee||!(!y||!y[fe])},Q=function y(g,l,p){var h;if(!g)return j;if(typeof g=="string"){var L=g.toLowerCase();z[L]&&(h=L),l&&(z[L]=l,h=L);var I=g.split("-");if(!h&&I.length>1)return y(I[0])}else{var M=g.name;z[M]=g,h=M}return!p&&h&&(j=h),h||!p&&j},F=function(y,g){if(ne(y))return y.clone();var l=typeof g=="object"?g:{};return l.date=y,l.args=arguments,new ee(l)},T=xe;T.l=Q,T.i=ne,T.w=function(y,g){return F(y,{locale:g.$L,utc:g.$u,x:g.$x,$offset:g.$offset})};var ee=function(){function y(l){this.$L=Q(l.locale,null,!0),this.parse(l),this.$x=this.$x||l.x||{},this[fe]=!0}var g=y.prototype;return g.parse=function(l){this.$d=function(p){var h=p.date,L=p.utc;if(h===null)return new Date(NaN);if(T.u(h))return new Date;if(h instanceof Date)return new Date(h);if(typeof h=="string"&&!/Z$/i.test(h)){var I=h.match(X);if(I){var M=I[2]-1||0,_=(I[7]||"0").substring(0,3);return L?new Date(Date.UTC(I[1],M,I[3]||1,I[4]||0,I[5]||0,I[6]||0,_)):new Date(I[1],M,I[3]||1,I[4]||0,I[5]||0,I[6]||0,_)}}return new Date(h)}(l),this.init()},g.init=function(){var l=this.$d;this.$y=l.getFullYear(),this.$M=l.getMonth(),this.$D=l.getDate(),this.$W=l.getDay(),this.$H=l.getHours(),this.$m=l.getMinutes(),this.$s=l.getSeconds(),this.$ms=l.getMilliseconds()},g.$utils=function(){return T},g.isValid=function(){return this.$d.toString()!==x},g.isSame=function(l,p){var h=F(l);return this.startOf(p)<=h&&h<=this.endOf(p)},g.isAfter=function(l,p){return F(l)<this.startOf(p)},g.isBefore=function(l,p){return this.endOf(p)<F(l)},g.$g=function(l,p,h){return T.u(l)?this[p]:this.set(h,l)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(l,p){var h=this,L=!!T.u(p)||p,I=T.p(l),M=function(R,C){var V=T.w(h.$u?Date.UTC(h.$y,C,R):new Date(h.$y,C,R),h);return L?V:V.endOf(m)},_=function(R,C){return T.w(h.toDate()[R].apply(h.toDate("s"),(L?[0,0,0,0]:[23,59,59,999]).slice(C)),h)},D=this.$W,E=this.$M,N=this.$D,W="set"+(this.$u?"UTC":"");switch(I){case A:return L?M(1,0):M(31,11);case w:return L?M(1,E):M(0,E+1);case S:var G=this.$locale().weekStart||0,Y=(D<G?D+7:D)-G;return M(L?N-Y:N+(6-Y),E);case m:case B:return _(W+"Hours",0);case u:return _(W+"Minutes",1);case r:return _(W+"Seconds",2);case a:return _(W+"Milliseconds",3);default:return this.clone()}},g.endOf=function(l){return this.startOf(l,!1)},g.$set=function(l,p){var h,L=T.p(l),I="set"+(this.$u?"UTC":""),M=(h={},h[m]=I+"Date",h[B]=I+"Date",h[w]=I+"Month",h[A]=I+"FullYear",h[u]=I+"Hours",h[r]=I+"Minutes",h[a]=I+"Seconds",h[t]=I+"Milliseconds",h)[L],_=L===m?this.$D+(p-this.$W):p;if(L===w||L===A){var D=this.clone().set(B,1);D.$d[M](_),D.init(),this.$d=D.set(B,Math.min(this.$D,D.daysInMonth())).$d}else M&&this.$d[M](_);return this.init(),this},g.set=function(l,p){return this.clone().$set(l,p)},g.get=function(l){return this[T.p(l)]()},g.add=function(l,p){var h,L=this;l=Number(l);var I=T.p(p),M=function(E){var N=F(L);return T.w(N.date(N.date()+Math.round(E*l)),L)};if(I===w)return this.set(w,this.$M+l);if(I===A)return this.set(A,this.$y+l);if(I===m)return M(1);if(I===S)return M(7);var _=(h={},h[r]=i,h[u]=n,h[a]=s,h)[I]||1,D=this.$d.getTime()+l*_;return T.w(D,this)},g.subtract=function(l,p){return this.add(-1*l,p)},g.format=function(l){var p=this,h=this.$locale();if(!this.isValid())return h.invalidDate||x;var L=l||"YYYY-MM-DDTHH:mm:ssZ",I=T.z(this),M=this.$H,_=this.$m,D=this.$M,E=h.weekdays,N=h.months,W=h.meridiem,G=function(C,V,J,te){return C&&(C[V]||C(p,L))||J[V].slice(0,te)},Y=function(C){return T.s(M%12||12,C,"0")},R=W||function(C,V,J){var te=C<12?"AM":"PM";return J?te.toLowerCase():te};return L.replace(q,function(C,V){return V||function(J){switch(J){case"YY":return String(p.$y).slice(-2);case"YYYY":return T.s(p.$y,4,"0");case"M":return D+1;case"MM":return T.s(D+1,2,"0");case"MMM":return G(h.monthsShort,D,N,3);case"MMMM":return G(N,D);case"D":return p.$D;case"DD":return T.s(p.$D,2,"0");case"d":return String(p.$W);case"dd":return G(h.weekdaysMin,p.$W,E,2);case"ddd":return G(h.weekdaysShort,p.$W,E,3);case"dddd":return E[p.$W];case"H":return String(M);case"HH":return T.s(M,2,"0");case"h":return Y(1);case"hh":return Y(2);case"a":return R(M,_,!0);case"A":return R(M,_,!1);case"m":return String(_);case"mm":return T.s(_,2,"0");case"s":return String(p.$s);case"ss":return T.s(p.$s,2,"0");case"SSS":return T.s(p.$ms,3,"0");case"Z":return I}return null}(C)||I.replace(":","")})},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(l,p,h){var L,I=this,M=T.p(p),_=F(l),D=(_.utcOffset()-this.utcOffset())*i,E=this-_,N=function(){return T.m(I,_)};switch(M){case A:L=N()/12;break;case w:L=N();break;case v:L=N()/3;break;case S:L=(E-D)/6048e5;break;case m:L=(E-D)/864e5;break;case u:L=E/n;break;case r:L=E/i;break;case a:L=E/s;break;default:L=E}return h?L:T.a(L)},g.daysInMonth=function(){return this.endOf(w).$D},g.$locale=function(){return z[this.$L]},g.locale=function(l,p){if(!l)return this.$L;var h=this.clone(),L=Q(l,p,!0);return L&&(h.$L=L),h},g.clone=function(){return T.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},y}(),Se=ee.prototype;return F.prototype=Se,[["$ms",t],["$s",a],["$m",r],["$H",u],["$W",m],["$M",w],["$y",A],["$D",B]].forEach(function(y){Se[y[1]]=function(g){return this.$g(g,y[0],y[1])}}),F.extend=function(y,g){return y.$i||(y(g,ee,F),y.$i=!0),F},F.locale=Q,F.isDayjs=ne,F.unix=function(y){return F(1e3*y)},F.en=z[j],F.Ls=z,F.p={},F})})(Ae);var tt=Ae.exports;const It=Ne(tt),st={enabled:!1,payload:{max_date:null,popup:{actionButtonLink:"",actionButtonText:"",cancelText1:"",cancelText2:"",description:void 0,showCountdown:!1,title1:"",title2:"",videoLink:""},banner:{actionButtonLink:"",actionButtonText:"",cancelText:"",description:"",title:""}}},rt={enabled:!1,payload:[]},at={enabled:!1,payload:[]},H={enabled:!1,payload:{"video-url":""}},it={dummyTrigger:!1,flags:{"dashboard-audio-help-video":H,"dashboard-document-help-video":H,"dashboard-funnel-help-video":H,"dashboard-home-help-video":H,"dashboard-media-help-video":H,"dashboard-message-help-video":H,"dashboard-trigger-help-video":H,flow:!1,"free-login":!0,"high-size-medias":!1,"item-scheduling":!1,"key-warning-ad":!1,"key-warning-ad-block":st,"login-by-key":!0,modals:rt,news:at,remarketing:!1,"renew-plan-redirect":!1,"social-login":!1,"social-register":!1,"track-auth-events":!0,"track-backup-events":!0,"track-engagement-events":!0,"track-exception-events":!0,"track-funnel-events":!0,"track-item-sent-events":!0,"track-misc-events":!0,"track-page-events":!0,"track-trigger-events":!0,"trigger-webhooks":!1,"video-tutorial":!1,"usage-limit":!0}},re="ZV:flags";class bt{constructor(e){o(this,"_store");o(this,"listeners",[]);o(this,"useGetFlags",()=>f(this.store,e=>e.flags));o(this,"useGetByName",e=>f(this.store,s=>s.getByName(e)));o(this,"getAll",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().getAll(...e)));o(this,"getByName",(...e)=>d.unstable_batchedUpdates(()=>this.store.getState().getByName(...e)));o(this,"updateAll",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().updateAll(...e)));this.zustandStorage=e,this._store=k()(O((s,i)=>({...it,toggleDummy:()=>s(n=>({dummyTrigger:!n.dummyTrigger})),getAll:async()=>i().flags,getByName:n=>i().flags[n],updateAll:async n=>s({flags:{...i().flags,...n}})}),{name:re,storage:$(()=>this.zustandStorage),version:0})),this.zustandStorage.addStorageListener(async()=>{await this.rehydrateStore()},[re])}addListener(e){this.listeners.push(e)}dispatchListeners(){for(const e of this.listeners)e()}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate();try{this.dispatchListeners()}catch(e){console.log(e)}},300)}get store(){return this._store}get flags(){return d.unstable_batchedUpdates(()=>this.store.getState().flags)}}const nt=["send_funnel","create_limited_flow","send_trigger"],ot={audio:{max:20,sent:0},bulkMessages:{max:2,sent:0},document:{max:20,sent:0},media:{max:20,sent:0},message:{max:20,sent:0},funnel:{max:5,sent:0},flow:{max:5,sent:0},scheduleItem:{max:5,sent:0}},dt={authError:null,authErrorMessage:null,deviceId:null,dummyTrigger:!1,isLoggedIn:!1,isPremium:!1,key:null,keyId:null,managerId:null,ownerId:null,phoneNumber:null,unauthorizedNumber:!1,userName:null,userProfilePic:null,wppVersion:null,permissions:nt,usageLimit:ot,isBasicPlan:!1,plan_id:""},Fe="ZV:authStore";class Tt{constructor(e,s,i,n,t={shouldMigrate:!1}){o(this,"_store");o(this,"listeners",[]);o(this,"useGetAuthData",()=>f(this.store,e=>({authError:e.authError,authErrorMessage:e.authErrorMessage,isLoggedIn:e.isLoggedIn,isPremium:e.isPremium,key:e.key,keyId:e.keyId,managerId:e.managerId,ownerId:e.ownerId,unauthorizedNumber:e.unauthorizedNumber,userName:e.userName,permissions:e.permissions,isBasicPlan:e.isBasicPlan,plan_id:e.plan_id})));o(this,"useGetPhoneNumber",()=>f(this.store,e=>e.phoneNumber));o(this,"useGetUsageLimit",()=>f(this.store,e=>e.usageLimit));o(this,"useGetUserName",()=>f(this.store,e=>e.userName));o(this,"useGetUserProfilePic",()=>f(this.store,e=>e.userProfilePic));o(this,"checkItemUsageLimit",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().checkItemUsageLimit(...e)));o(this,"getAuthData",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().getAuthData(...e)));o(this,"login",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().login(...e)));o(this,"logout",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().logout(...e)));o(this,"refreshPremium",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().refreshPremium(...e)));o(this,"setPhoneNumber",(...e)=>d.unstable_batchedUpdates(async()=>{this.store.getState().setPhoneNumber(...e)}));o(this,"setUserProfilePic",(...e)=>d.unstable_batchedUpdates(async()=>{this.store.getState().setUserProfilePic(...e)}));o(this,"setWppVersion",(...e)=>d.unstable_batchedUpdates(async()=>{this.store.getState().setWppVersion(...e)}));o(this,"updateItemUsageLimit",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().updateItemUsageLimit(...e)));this.zustandStorage=e,this.fetchBackendAuthData=s,this.fetchBackendUsageLimitData=i,this.fetchBackendGetUsageLimitData=n,this.options=t,this._store=k()(O((a,r)=>({...dt,toggleDummy:()=>a(u=>({dummyTrigger:!u.dummyTrigger})),checkItemUsageLimit:async u=>{const m=this._store.getState(),S=m.isBasicPlan&&(u==="flow"||u==="bulkMessages"||u==="scheduleItem");if(!(m.isPremium===!1||m.isLoggedIn===!1||!!m.authError||S))return{canProceed:!0};const v=await this.fetchBackendGetUsageLimitData({phoneNumber:m.phoneNumber??"",planId:m.plan_id,hasError:!!m.authError,isBasic:m.isBasicPlan});if(!v.status||!v.limits)return{canProceed:!1};a({usageLimit:v.limits});const A=v.limits[u].sent,B=v.limits[u].max;return A>=B?{canProceed:!1}:{canProceed:!0}},getAuthData:async()=>({authError:r().authError,authErrorMessage:r().authErrorMessage,isLoggedIn:r().isLoggedIn,isPremium:r().isPremium,key:r().key,keyId:r().keyId,managerId:r().managerId,ownerId:r().ownerId,unauthorizedNumber:r().unauthorizedNumber,userName:r().userName,permissions:r().permissions,isBasicPlan:r().isBasicPlan,plan_id:r().plan_id}),getUsageLimit:()=>r().usageLimit,login:async({key:u,keyId:m,managerId:S,ownerId:w,shouldGetUsage:v})=>{const A=await this.zustandStorage.getParsedItem(re),B=!!A&&A.state.flags["free-login"];let x={authError:null,authErrorMessage:null,isLoggedIn:B,isPremium:!1,key:null,keyId:null,managerId:null,ownerId:null,unauthorizedNumber:!1,userName:B?"Usuário Gratuito":"",permissions:[],isBasicPlan:!1,plan_id:B?"ZV_FREE":""};if(u)try{x=await this.fetchBackendAuthData({key:b(u,{toLowerCase:!0}),phoneNumber:r().phoneNumber,userName:r().userName,wppVersion:r().wppVersion})}catch(q){console.error(q)}let X=r().usageLimit;if(v){const q=x.isPremium===!1||x.isLoggedIn===!1||!!x.authError||x.isBasicPlan;if(this.phoneNumber&&q){const K=await this.fetchBackendGetUsageLimitData({phoneNumber:r().phoneNumber??"",planId:x.plan_id,hasError:!!x.authError,isBasic:x.isBasicPlan});K.status&&K.limits&&(X=K.limits)}}return a({...x,keyId:x.keyId??m,managerId:x.managerId??S,ownerId:x.ownerId??w,usageLimit:X}),x},logout:async()=>{const u={authError:null,authErrorMessage:null,isLoggedIn:!1,isPremium:!1,key:null,keyId:null,managerId:null,ownerId:null,unauthorizedNumber:!1,userName:"Usuário não logado",permissions:[],isBasicPlan:!1,plan_id:""};return a({...u}),u},refreshPremium:async u=>{const m=r().key,S=r().keyId,w=r().managerId,v=r().ownerId;return r().isLoggedIn?this.login({key:m,keyId:S,managerId:w,ownerId:v,shouldGetUsage:u}):this.logout()},setPhoneNumber:async u=>{a({phoneNumber:u})},setUserProfilePic:async u=>{a({userProfilePic:u})},setWppVersion:async u=>{a({wppVersion:u})},updateItemUsageLimit:async(u,m="increase")=>{const S=this._store.getState(),w=S.isBasicPlan&&(u==="flow"||u==="bulkMessages"||u==="scheduleItem");if(S.isPremium===!1||S.isLoggedIn===!1||S.authError||w){const v=await this.fetchBackendUsageLimitData({action:m,itemType:u,phoneNumber:S.phoneNumber??"",planId:S.plan_id,hasError:!!S.authError,isBasic:S.isBasicPlan});if(v.status)v.limits&&(S.usageLimit=v.limits),a(S);else if(v.errorType==="MAX_LIMIT_REACHED"){const A=S.usageLimit[u].sent,B=S.usageLimit[u].max;A<B&&(S.usageLimit[u].sent=B,a(S))}return v}return{limits:S.usageLimit,message:"Mensagem enviada",status:!0}}}),{name:Fe,storage:$(()=>this.zustandStorage),version:0})),this.options.shouldMigrate&&this.validateAuthMigration(),this.zustandStorage.addStorageListener(async()=>{this.rehydrateStore()},[Fe])}addListener(e){this.listeners.push(e)}dispatchListeners(){for(const e of this.listeners)e()}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate();try{this.dispatchListeners()}catch(e){console.log(e)}},300)}get store(){return this._store}get authData(){return d.unstable_batchedUpdates(()=>({authError:this.store.getState().authError,authErrorMessage:this.store.getState().authErrorMessage,isLoggedIn:this.store.getState().isLoggedIn,isPremium:this.store.getState().isPremium,key:this.store.getState().key,keyId:this.store.getState().keyId,managerId:this.store.getState().managerId,ownerId:this.store.getState().ownerId,unauthorizedNumber:this.store.getState().unauthorizedNumber,userName:this.store.getState().userName,permissions:this.store.getState().permissions,isBasicPlan:this.store.getState().isBasicPlan,plan_id:this.store.getState().plan_id}))}get deviceId(){return d.unstable_batchedUpdates(()=>this.store.getState().deviceId)}get authError(){return d.unstable_batchedUpdates(()=>this.store.getState().authError)}get authErrorMessage(){return d.unstable_batchedUpdates(()=>this.store.getState().authErrorMessage)}get isLoggedIn(){return d.unstable_batchedUpdates(()=>this.store.getState().isLoggedIn)}get isPremium(){return d.unstable_batchedUpdates(()=>this.store.getState().isPremium)}get key(){return d.unstable_batchedUpdates(()=>this.store.getState().key)}get phoneNumber(){return d.unstable_batchedUpdates(()=>this.store.getState().phoneNumber)}get wppVersion(){return d.unstable_batchedUpdates(()=>this.store.getState().wppVersion)}get userName(){return d.unstable_batchedUpdates(()=>this.store.getState().userName)}get userProfilePic(){return d.unstable_batchedUpdates(()=>this.store.getState().userProfilePic)}isEnablePermission(e){return d.unstable_batchedUpdates(()=>this.store.getState().permissions.includes(e))}async migrateFromOldSchema({key:e,deviceId:s}){if(this.store.setState({key:e?b(e,{toLowerCase:!0}):null,deviceId:s}),e){const i=await this.zustandStorage.getParsedItem(re),n=!!i&&i.state.flags["usage-limit"];this.login({key:e,keyId:null,managerId:null,ownerId:null,shouldGetUsage:n})}}async getOldDeviceId(){const e="deviceId",s=await this.zustandStorage.getParsedItem(e);if(!s){const i=Ue();return await this.zustandStorage.setItem(e,i),i}return s}async getOldKey(){return await this.zustandStorage.getParsedItem("chave")}async validateAuthMigration(){const e="migratedAuthData";if(await this.zustandStorage.getParsedItem(e))return;const i=this._store.getState().key;if(!!i)return;const t=await this.getOldKey(),a=await this.getOldDeviceId();!i&&!!t&&(await this.zustandStorage.setItem(e,"true"),await this.migrateFromOldSchema({key:b(t,{toLowerCase:!0}),deviceId:a}))}}class Mt extends Error{constructor(s,i="UNKNOWN"){super(s);o(this,"code");this.code=i}}const ut={clientId:void 0,dummyTrigger:!1,keyId:null,managerId:null,userId:null,whatsappIsBeta:null,whatsappVersion:null,zapvoiceVersion:null},De="ZV:trackerStore";class _t{constructor(e){o(this,"_store");o(this,"listeners",[]);o(this,"getClientId",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().getClientId(...e)));o(this,"getSessionCount",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().getSessionCount(...e)));o(this,"getSessionId",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().getSessionId(...e)));o(this,"getTrackerUserProperties",(...e)=>d.unstable_batchedUpdates(async()=>this.store.getState().getTrackerUserProperties(...e)));this.zustandStorage=e,this._store=k()(O((s,i)=>({...ut,toggleDummy:()=>s(n=>({dummyTrigger:!n.dummyTrigger})),getSessionCount:async n=>this.zustandStorage.getParsedSessionItem(n),getSessionId:async n=>await this.zustandStorage.getParsedSessionItem(n),getClientId:async()=>i().clientId,getTrackerUserProperties:async()=>({keyId:i().keyId,managerId:i().managerId,userId:i().userId,whatsappVersion:i().whatsappVersion,whatsappIsBeta:i().whatsappIsBeta,zapvoiceVersion:i().zapvoiceVersion}),setClientId:async n=>(s({clientId:n}),n),setKeyId:async n=>s({keyId:n}),setManagerId:async n=>s({managerId:n}),setSessionCount:async(n,t)=>(this.zustandStorage.setSessionItem(n,String(t)),t),setSessionId:async(n,t)=>(this.zustandStorage.setSessionItem(n,String(t)),t),setUserId:async n=>s({userId:n}),setTrackerUserProperties:async n=>s({...n}),setWhatsAppIsBeta:async n=>s({whatsappIsBeta:n}),setWhatsAppVersion:async n=>s({whatsappVersion:n}),setZapvoiceVersion:async n=>s({zapvoiceVersion:n})}),{name:De,storage:$(()=>this.zustandStorage),version:0})),this.zustandStorage.addStorageListener(async()=>{this.rehydrateStore()},[De])}addListener(e){this.listeners.push(e)}dispatchListeners(){this.listeners.forEach(e=>e())}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate();try{this.dispatchListeners()}catch(e){console.log(e)}},300)}get store(){return this._store}setClientId(...e){return this.store.getState().setClientId(...e)}setKeyId(...e){return this.store.getState().setKeyId(...e)}setManagerId(...e){return this.store.getState().setManagerId(...e)}setSessionCount(...e){return this.store.getState().setSessionCount(...e)}setSessionId(...e){return this.store.getState().setSessionId(...e)}setUserId(...e){return this.store.getState().setUserId(...e)}setTrackerUserProperties(...e){return this.store.getState().setTrackerUserProperties(...e)}setWhatsAppIsBeta(...e){return this.store.getState().setWhatsAppIsBeta(...e)}setWhatsAppVersion(...e){return this.store.getState().setWhatsAppVersion(...e)}setZapvoiceVersion(...e){return this.store.getState().setZapvoiceVersion(...e)}}const wt=()=>{let c=chrome.runtime.id;try{const e=window.localStorage.getItem("ZV:extensionId");e&&(c=e)}catch(e){e instanceof Error&&e.toString()!=="ReferenceError: window is not defined"&&console.log(e)}if(!c)throw new Error("extensionId not found");return c};export{oe as A,Mt as B,pt as C,Ve as D,Z as E,bt as F,ft as G,wt as H,ot as I,pe as J,tt as K,Je as L,le as M,Qe as N,St as S,he as T,P as U,ze as a,Re as b,We as c,Ke as d,Ze as e,et as f,It as g,ce as h,ue as i,de as j,ge as k,me as l,it as m,b as n,st as o,rt as p,at as q,H as r,Tt as s,_t as t,ht as u,Ue as v,mt as w,yt as x,gt as y,Lt as z};
