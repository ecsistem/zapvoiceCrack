var Ee=Object.defineProperty;var Se=(o,n,e)=>n in o?Ee(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e;var N=(o,n,e)=>Se(o,typeof n!="symbol"?n+"":n,e);import "./chunk-BqDfMDXV.js";
import { g as C, c as Ne, Z as Oe, b as Y, C as ke } from "./chunk-Co4l0zX2.js";
import { S as De, o as H, z as K, m as Me, p as V, r as W, q } from "./chunk-Da8Krtva.js";
import { S as Ie } from "./chunk-KV1RO73G.js";
import { g as Ae, i as Le, h as Pe, c as R, a as Re, d as S, S as T, e as Te, f as Ue, C as _e, b as xe } from "./chunk-frpNZGJs.js";
const Ce=new De(new Oe);function Be(){S.store.getState(),Re.store.getState(),Te.store.getState(),R.store.getState(),xe.store.getState(),Ue.store.getState(),Ne.store.getState(),Ae.store.getState(),Pe.store.getState(),Ce.store.getState()}function je(){const o=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)./);return o?parseInt(o[2],10):1/0}async function pe(o,n=!1){const e=await chrome.tabs.query({}),t=e.find(s=>{var i,a;return s.active&&((i=s.url)==null?void 0:i.includes(o))&&!((a=s.favIconUrl)!=null&&a.includes("error"))})||e.find(s=>{var i;return s.active&&((i=s.url)==null?void 0:i.includes(o))});return n?t:t||e.find(s=>{var i,a;return((i=s.url)==null?void 0:i.includes(o))&&!((a=s.favIconUrl)!=null&&a.includes("error"))})||e.find(s=>{var i;return(i=s.url)==null?void 0:i.includes(o)})}class Fe{constructor(){N(this,"flagsStore",R)}async getAll(...n){return await this.flagsStore.getAll(...n)}getByName(...n){return this.flagsStore.getByName(...n)}async updateAll(...n){return await this.flagsStore.updateAll(...n)}}const He=["dashboard-audio-help-video","dashboard-document-help-video","dashboard-funnel-help-video","dashboard-home-help-video","dashboard-media-help-video","dashboard-message-help-video","dashboard-trigger-help-video","flow","free-login","high-size-medias","item-scheduling","key-warning-ad","key-warning-ad-block","login-by-key","modals","news","remarketing","renew-plan-redirect","social-login","social-register","track-auth-events","track-backup-events","track-engagement-events","track-exception-events","track-funnel-events","track-item-sent-events","track-misc-events","track-page-events","track-trigger-events","trigger-webhooks","video-tutorial","usage-limit"];var Z=function(o,n){return Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Z(o,n)},p=function(){return p=Object.assign||function(o){for(var n,e=1,t=arguments.length;e<t;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r]);return o},p.apply(this,arguments)};function v(o,n,e,t){return new(e||(e=Promise))(function(r,s){function i(l){try{u(t.next(l))}catch(c){s(c)}}function a(l){try{u(t.throw(l))}catch(c){s(c)}}function u(l){var c;l.done?r(l.value):(c=l.value,c instanceof e?c:new e(function(d){d(c)})).then(i,a)}u((t=t.apply(o,[])).next())})}function y(o,n){var e,t,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(s=0)),s;)try{if(e=1,t&&(r=2&c[0]?t.return:c[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,c[1])).done)return r;switch(t=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,t=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!((r=r.length>0&&r[r.length-1])||c[0]!==6&&c[0]!==2)){s=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){s.label=c[1];break}if(c[0]===6&&s.label<r[1]){s.label=r[1],r=c;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(c);break}r[2]&&s.ops.pop(),s.trys.pop();continue}c=n.call(o,s)}catch(d){c=[6,d],t=0}finally{e=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var fe={exports:{}};function J(){}J.prototype={on:function(o,n,e){var t=this.e||(this.e={});return(t[o]||(t[o]=[])).push({fn:n,ctx:e}),this},once:function(o,n,e){var t=this;function r(){t.off(o,r),n.apply(e,arguments)}return r._=n,this.on(o,r,e)},emit:function(o){for(var n=[].slice.call(arguments,1),e=((this.e||(this.e={}))[o]||[]).slice(),t=0,r=e.length;t<r;t++)e[t].fn.apply(e[t].ctx,n);return this},off:function(o,n){var e=this.e||(this.e={}),t=e[o],r=[];if(t&&n)for(var s=0,i=t.length;s<i;s++)t[s].fn!==n&&t[s].fn._!==n&&r.push(t[s]);return r.length?e[o]=r:delete e[o],this}},fe.exports=J;var Ve=fe.exports.TinyEmitter=J,D=function(o){var n=o[1];return n!=null},qe=function(o){var n=o.properties,e=n===void 0?{}:n,t=function(s,i){var a={};for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&i.indexOf(u)<0&&(a[u]=s[u]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var l=0;for(u=Object.getOwnPropertySymbols(s);l<u.length;l++)i.indexOf(u[l])<0&&Object.prototype.propertyIsEnumerable.call(s,u[l])&&(a[u[l]]=s[u[l]])}return a}(o,["properties"]),r=function(s){return Object.entries(s).sort(function(i,a){var u=i[0],l=a[0];return u.localeCompare(l,void 0)})};return JSON.stringify([r(t),r(e)])},ae=function(o){return v(void 0,void 0,void 0,function(){var n;return y(this,function(e){switch(e.label){case 0:n=qe(o),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(t=n,v(void 0,void 0,void 0,function(){var r,s,i,a,u;return y(this,function(l){switch(l.label){case 0:if(r=typeof globalThis<"u"&&(!((a=globalThis.crypto)===null||a===void 0)&&a.subtle)?(u=globalThis.crypto)===null||u===void 0?void 0:u.subtle:void 0,typeof TextEncoder>"u"||!(r!=null&&r.digest)||typeof Uint8Array>"u")throw new Error("Hashing function not available");return s=new TextEncoder().encode(t),[4,r.digest("SHA-256",s)];case 1:return i=l.sent(),[2,Array.from(new Uint8Array(i)).map(function(c){return c.toString(16).padStart(2,"0")}).join("")]}})}))];case 2:return[2,e.sent()];case 3:return e.sent(),[2,n];case 4:return[2]}var t})})},We=function(){},Ge=function(){function o(n){var e=n.onError,t=n.onSent,r=n.appName,s=n.metricsInterval,i=n.disableMetrics,a=i!==void 0&&i,u=n.url,l=n.clientKey,c=n.fetch,d=n.headerName,g=n.customHeaders,b=g===void 0?{}:g,w=n.metricsIntervalInitial;this.onError=e,this.onSent=t||We,this.disabled=a,this.metricsInterval=1e3*s,this.metricsIntervalInitial=1e3*w,this.appName=r,this.url=u instanceof URL?u:new URL(u),this.clientKey=l,this.bucket=this.createEmptyBucket(),this.fetch=c,this.headerName=d,this.customHeaders=b}return o.prototype.start=function(){var n=this;if(this.disabled)return!1;typeof this.metricsInterval=="number"&&this.metricsInterval>0&&(this.metricsIntervalInitial>0?setTimeout(function(){n.startTimer(),n.sendMetrics()},this.metricsIntervalInitial):this.startTimer())},o.prototype.stop=function(){this.timer&&(clearTimeout(this.timer),delete this.timer)},o.prototype.createEmptyBucket=function(){return{start:new Date,stop:null,toggles:{}}},o.prototype.getHeaders=function(){var n,e=((n={})[this.headerName]=this.clientKey,n.Accept="application/json",n["Content-Type"]="application/json",n);return Object.entries(this.customHeaders).filter(D).forEach(function(t){var r=t[0],s=t[1];return e[r]=s}),e},o.prototype.sendMetrics=function(){return v(this,void 0,void 0,function(){var n,e,t;return y(this,function(r){switch(r.label){case 0:if(n="".concat(this.url,"/client/metrics"),e=this.getPayload(),this.bucketIsEmpty(e))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.fetch(n,{cache:"no-cache",method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)})];case 2:return r.sent(),this.onSent(e),[3,4];case 3:return t=r.sent(),console.error("Unleash: unable to send feature metrics",t),this.onError(t),[3,4];case 4:return[2]}})})},o.prototype.count=function(n,e){return!(this.disabled||!this.bucket)&&(this.assertBucket(n),this.bucket.toggles[n][e?"yes":"no"]++,!0)},o.prototype.countVariant=function(n,e){return!(this.disabled||!this.bucket)&&(this.assertBucket(n),this.bucket.toggles[n].variants[e]?this.bucket.toggles[n].variants[e]+=1:this.bucket.toggles[n].variants[e]=1,!0)},o.prototype.assertBucket=function(n){if(this.disabled||!this.bucket)return!1;this.bucket.toggles[n]||(this.bucket.toggles[n]={yes:0,no:0,variants:{}})},o.prototype.startTimer=function(){var n=this;this.timer=setInterval(function(){n.sendMetrics()},this.metricsInterval)},o.prototype.bucketIsEmpty=function(n){return Object.keys(n.bucket.toggles).length===0},o.prototype.getPayload=function(){var n=p(p({},this.bucket),{stop:new Date});return this.bucket=this.createEmptyBucket(),{bucket:n,appName:this.appName,instanceId:"browser"}},o}(),ze=function(){function o(){this.store=new Map}return o.prototype.save=function(n,e){return v(this,void 0,void 0,function(){return y(this,function(t){return this.store.set(n,e),[2]})})},o.prototype.get=function(n){return v(this,void 0,void 0,function(){return y(this,function(e){return[2,this.store.get(n)]})})},o}(),Ye=function(){function o(n){n===void 0&&(n="unleash:repository"),this.prefix=n}return o.prototype.save=function(n,e){return v(this,void 0,void 0,function(){var t,r;return y(this,function(s){t=JSON.stringify(e),r="".concat(this.prefix,":").concat(n);try{window.localStorage.setItem(r,t)}catch(i){console.error(i)}return[2]})})},o.prototype.get=function(n){try{var e="".concat(this.prefix,":").concat(n),t=window.localStorage.getItem(e);return t?JSON.parse(t):void 0}catch(r){console.error(r)}},o}();let k;const Ke=new Uint8Array(16);function Ze(){if(!k&&(k=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!k))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(Ke)}const f=[];for(let o=0;o<256;++o)f.push((o+256).toString(16).slice(1));var ce={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Je(o,n,e){if(ce.randomUUID&&!n&&!o)return ce.randomUUID();const t=(o=o||{}).random||(o.rng||Ze)();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,function(r,s=0){return f[r[s+0]]+f[r[s+1]]+f[r[s+2]]+f[r[s+3]]+"-"+f[r[s+4]]+f[r[s+5]]+"-"+f[r[s+6]]+f[r[s+7]]+"-"+f[r[s+8]]+f[r[s+9]]+"-"+f[r[s+10]]+f[r[s+11]]+f[r[s+12]]+f[r[s+13]]+f[r[s+14]]+f[r[s+15]]}(t)}var Xe=function(){function o(){}return o.prototype.generateEventId=function(){return Je()},o.prototype.createImpressionEvent=function(n,e,t,r,s,i){var a=this.createBaseEvent(n,e,t,r,s);return i?p(p({},a),{variant:i}):a},o.prototype.createBaseEvent=function(n,e,t,r,s){return{eventType:r,eventId:this.generateEventId(),context:n,enabled:e,featureName:t,impressionData:s}},o}(),$e=["userId","sessionId","remoteAddress","currentTime"],le=function(o){return $e.includes(o)},E={INIT:"initialized",ERROR:"error",READY:"ready",UPDATE:"update",IMPRESSION:"impression",SENT:"sent",RECOVERED:"recovered"},Qe="isEnabled",et="getVariant",tt={name:"disabled",enabled:!1,feature_enabled:!1},G="repo",ue="repoLastUpdateTimestamp",rt=function(){try{if(typeof window<"u"&&"fetch"in window)return fetch.bind(window);if("fetch"in globalThis)return fetch.bind(globalThis)}catch(o){console.error('Unleash failed to resolve "fetch"',o)}},nt=function(o){function n(e){var t=e.storageProvider,r=e.url,s=e.clientKey,i=e.disableRefresh,a=i!==void 0&&i,u=e.refreshInterval,l=u===void 0?30:u,c=e.metricsInterval,d=c===void 0?30:c,g=e.metricsIntervalInitial,b=g===void 0?2:g,w=e.disableMetrics,x=w!==void 0&&w,I=e.appName,U=e.environment,L=U===void 0?"default":U,B=e.context,_=e.fetch,j=_===void 0?rt():_,$=e.createAbortController,Q=$===void 0?function(){try{if(typeof window<"u"&&"AbortController"in window)return function(){return new window.AbortController};if("fetch"in globalThis)return function(){return new globalThis.AbortController}}catch(O){console.error('Unleash failed to resolve "AbortController" factory',O)}}():$,A=e.bootstrap,ee=e.bootstrapOverride,ye=ee===void 0||ee,te=e.headerName,re=te===void 0?"Authorization":te,ne=e.customHeaders,se=ne===void 0?{}:ne,oe=e.impressionDataAll,be=oe!==void 0&&oe,ie=e.usePOSTrequests,we=ie!==void 0&&ie,P=e.experimental,h=o.call(this)||this;if(h.toggles=[],h.etag="",h.readyEventEmitted=!1,h.fetchedFromServer=!1,h.usePOSTrequests=!1,h.started=!1,!r)throw new Error("url is required");if(!s)throw new Error("clientKey is required");if(!I)throw new Error("appName is required.");return h.eventsHandler=new Xe,h.impressionDataAll=be,h.toggles=A&&A.length>0?A:[],h.url=r instanceof URL?r:new URL(r),h.clientKey=s,h.headerName=re,h.customHeaders=se,h.storage=t||(typeof window<"u"?new Ye:new ze),h.refreshInterval=a?0:1e3*l,h.context=p({appName:I,environment:L},B),h.usePOSTrequests=we,h.sdkState="initializing",h.experimental=p({},P),P!=null&&P.togglesStorageTTL&&(P==null?void 0:P.togglesStorageTTL)>0&&(h.experimental.togglesStorageTTL=1e3*P.togglesStorageTTL),h.lastRefreshTimestamp=0,h.ready=new Promise(function(O){h.init().then(O).catch(function(F){console.error(F),h.sdkState="error",h.emit(E.ERROR,F),h.lastError=F,O()})}),j||console.error('Unleash: You must either provide your own "fetch" implementation or run in an environment where "fetch" is available.'),Q||console.error('Unleash: You must either provide your own "AbortController" implementation or run in an environment where "AbortController" is available.'),h.fetch=j,h.createAbortController=Q,h.bootstrap=A&&A.length>0?A:void 0,h.bootstrapOverride=ye,h.metrics=new Ge({onError:h.emit.bind(h,E.ERROR),onSent:h.emit.bind(h,E.SENT),appName:I,metricsInterval:d,disableMetrics:x,url:h.url,clientKey:s,fetch:j,headerName:re,customHeaders:se,metricsIntervalInitial:b}),h}return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Z(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}(n,o),n.prototype.getAllToggles=function(){return function(e,t,r){for(var s,i=0,a=t.length;i<a;i++)!s&&i in t||(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return e.concat(s||Array.prototype.slice.call(t))}([],this.toggles)},n.prototype.isEnabled=function(e){var t,r=this.toggles.find(function(a){return a.name===e}),s=!!r&&r.enabled;if(this.metrics.count(e,s),(r==null?void 0:r.impressionData)||this.impressionDataAll){var i=this.eventsHandler.createImpressionEvent(this.context,s,e,Qe,(t=r==null?void 0:r.impressionData)!==null&&t!==void 0?t:void 0);this.emit(E.IMPRESSION,i)}return s},n.prototype.getVariant=function(e){var t,r=this.toggles.find(function(u){return u.name===e}),s=(r==null?void 0:r.enabled)||!1,i=r?r.variant:tt;if(i.name&&this.metrics.countVariant(e,i.name),this.metrics.count(e,s),(r==null?void 0:r.impressionData)||this.impressionDataAll){var a=this.eventsHandler.createImpressionEvent(this.context,s,e,et,(t=r==null?void 0:r.impressionData)!==null&&t!==void 0?t:void 0,i.name);this.emit(E.IMPRESSION,a)}return p(p({},i),{feature_enabled:s})},n.prototype.updateToggles=function(){return v(this,void 0,void 0,function(){var e=this;return y(this,function(t){switch(t.label){case 0:return this.timerRef||this.fetchedFromServer?[4,this.fetchToggles()]:[3,2];case 1:return t.sent(),[3,4];case 2:return this.started?[4,new Promise(function(r){var s=function(){e.fetchToggles().then(function(){e.off(E.READY,s),r()})};e.once(E.READY,s)})]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2]}})})},n.prototype.updateContext=function(e){return v(this,void 0,void 0,function(){var t;return y(this,function(r){switch(r.label){case 0:return(e.appName||e.environment)&&console.warn("appName and environment are static. They can't be updated with updateContext."),t={environment:this.context.environment,appName:this.context.appName,sessionId:this.context.sessionId},this.context=p(p({},t),e),[4,this.updateToggles()];case 1:return r.sent(),[2]}})})},n.prototype.getContext=function(){return p({},this.context)},n.prototype.setContextField=function(e,t){var r,s;if(le(e))this.context=p(p({},this.context),((r={})[e]=t,r));else{var i=p(p({},this.context.properties),((s={})[e]=t,s));this.context=p(p({},this.context),{properties:i})}this.updateToggles()},n.prototype.removeContextField=function(e){var t;le(e)?this.context=p(p({},this.context),((t={})[e]=void 0,t)):typeof this.context.properties=="object"&&delete this.context.properties[e],this.updateToggles()},n.prototype.setReady=function(){this.readyEventEmitted=!0,this.emit(E.READY)},n.prototype.init=function(){return v(this,void 0,void 0,function(){var e,t,r;return y(this,function(s){switch(s.label){case 0:return[4,this.resolveSessionId()];case 1:return e=s.sent(),this.context=p({sessionId:e},this.context),t=this,[4,this.storage.get(G)];case 2:return t.toggles=s.sent()||[],r=this,[4,this.getLastRefreshTimestamp()];case 3:return r.lastRefreshTimestamp=s.sent(),!this.bootstrap||!this.bootstrapOverride&&this.toggles.length!==0?[3,6]:[4,this.storage.save(G,this.bootstrap)];case 4:return s.sent(),this.toggles=this.bootstrap,this.sdkState="healthy",[4,this.storeLastRefreshTimestamp()];case 5:s.sent(),this.setReady(),s.label=6;case 6:return this.sdkState="healthy",this.emit(E.INIT),[2]}})})},n.prototype.start=function(){return v(this,void 0,void 0,function(){var e,t=this;return y(this,function(r){switch(r.label){case 0:return this.started=!0,this.timerRef?(console.error("Unleash SDK has already started, if you want to restart the SDK you should call client.stop() before starting again."),[2]):[4,this.ready];case 1:return r.sent(),this.metrics.start(),e=this.refreshInterval,[4,this.initialFetchToggles()];case 2:return r.sent(),e>0&&(this.timerRef=setInterval(function(){return t.fetchToggles()},e)),[2]}})})},n.prototype.stop=function(){this.timerRef&&(clearInterval(this.timerRef),this.timerRef=void 0),this.metrics.stop()},n.prototype.isReady=function(){return this.readyEventEmitted},n.prototype.getError=function(){return this.sdkState==="error"?this.lastError:void 0},n.prototype.sendMetrics=function(){return this.metrics.sendMetrics()},n.prototype.resolveSessionId=function(){return v(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.context.sessionId?[2,this.context.sessionId]:[4,this.storage.get("sessionId")];case 1:return(e=t.sent())?[3,3]:(e=Math.floor(1e9*Math.random()),[4,this.storage.save("sessionId",e.toString(10))]);case 2:t.sent(),t.label=3;case 3:return[2,e.toString(10)]}})})},n.prototype.getHeaders=function(){var e,t=this.usePOSTrequests,r=((e={})[this.headerName]=this.clientKey,e.Accept="application/json",e);return t&&(r["Content-Type"]="application/json"),this.etag&&(r["If-None-Match"]=this.etag),Object.entries(this.customHeaders).filter(D).forEach(function(s){var i=s[0],a=s[1];return r[i]=a}),r},n.prototype.storeToggles=function(e){return v(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.toggles=e,this.emit(E.UPDATE),[4,this.storage.save(G,e)];case 1:return t.sent(),[2]}})})},n.prototype.isTogglesStorageTTLEnabled=function(){var e;return!!(!((e=this.experimental)===null||e===void 0)&&e.togglesStorageTTL&&this.experimental.togglesStorageTTL>0)},n.prototype.isUpToDate=function(){var e;if(!this.isTogglesStorageTTLEnabled())return!1;var t=Date.now(),r=((e=this.experimental)===null||e===void 0?void 0:e.togglesStorageTTL)||0;return this.lastRefreshTimestamp>0&&this.lastRefreshTimestamp<=t&&t-this.lastRefreshTimestamp<=r},n.prototype.getLastRefreshTimestamp=function(){return v(this,void 0,void 0,function(){var e,t;return y(this,function(r){switch(r.label){case 0:return this.isTogglesStorageTTLEnabled()?[4,this.storage.get(ue)]:[3,3];case 1:return e=r.sent(),[4,ae(this.context)];case 2:return t=r.sent(),[2,(e==null?void 0:e.key)===t?e.timestamp:0];case 3:return[2,0]}})})},n.prototype.storeLastRefreshTimestamp=function(){return v(this,void 0,void 0,function(){var e,t;return y(this,function(r){switch(r.label){case 0:return this.isTogglesStorageTTLEnabled()?(this.lastRefreshTimestamp=Date.now(),t={},[4,ae(this.context)]):[3,3];case 1:return t.key=r.sent(),t.timestamp=this.lastRefreshTimestamp,e=t,[4,this.storage.save(ue,e)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},n.prototype.initialFetchToggles=function(){if(!this.isUpToDate())return this.fetchToggles();this.fetchedFromServer||(this.fetchedFromServer=!0,this.setReady())},n.prototype.fetchToggles=function(){return v(this,void 0,void 0,function(){var e,t,r,s,i,a,u,l,c;return y(this,function(d){switch(d.label){case 0:if(!this.fetch)return[3,9];this.abortController&&this.abortController.abort(),this.abortController=(c=this.createAbortController)===null||c===void 0?void 0:c.call(this),e=this.abortController?this.abortController.signal:void 0,d.label=1;case 1:return d.trys.push([1,7,8,9]),t=this.usePOSTrequests,r=t?this.url:function(g,b){var w=new URL(g.toString());return Object.entries(b).filter(D).forEach(function(x){var I=x[0],U=x[1];I==="properties"&&U?Object.entries(U).filter(D).forEach(function(L){var B=L[0],_=L[1];return w.searchParams.append("properties[".concat(B,"]"),_)}):w.searchParams.append(I,U)}),w}(this.url,this.context),s=t?"POST":"GET",i=t?JSON.stringify({context:this.context}):void 0,[4,this.fetch(r.toString(),{method:s,cache:"no-cache",headers:this.getHeaders(),body:i,signal:e})];case 2:return a=d.sent(),this.sdkState==="error"&&a.status<400&&(this.sdkState="healthy",this.emit(E.RECOVERED)),a.ok?(this.etag=a.headers.get("ETag")||"",[4,a.json()]):[3,5];case 3:return u=d.sent(),[4,this.storeToggles(u.toggles)];case 4:return d.sent(),this.sdkState!=="healthy"&&(this.sdkState="healthy"),this.fetchedFromServer||(this.fetchedFromServer=!0,this.setReady()),this.storeLastRefreshTimestamp(),[3,6];case 5:a.status===304?this.storeLastRefreshTimestamp():(console.error("Unleash: Fetching feature toggles did not have an ok response"),this.sdkState="error",this.emit(E.ERROR,{type:"HttpError",code:a.status}),this.lastError={type:"HttpError",code:a.status}),d.label=6;case 6:return[3,9];case 7:return typeof(l=d.sent())=="object"&&l!==null&&"name"in l&&l.name==="AbortError"||(console.error("Unleash: unable to fetch feature toggles",l),this.sdkState="error",this.emit(E.ERROR,l),this.lastError=l),[3,9];case 8:return this.abortController=null,[7];case 9:return[2]}})})},n}(Ve);const me=new Fe,st={url:K("==Aa0RHczpzLvU3cuEGcw5SduxWZhNHatg2bzRXZk5yYv12L1NHZkBDMxAzLhBXavYmcv5Gdl5GZ"),appName:"zap-voice",clientKey:K("kVmZhVHb0pDcy9GZ1NGdp9mbukTY0EjZ3EzMjZGZjljNlNjYmVWZzkDOlRTO4YWY0UGM5UWM4EmY1UDMjVDM3ETMwIWN2EWZmNTM"),refreshInterval:1*60*60*24,disableMetrics:!0},m=new nt(st);m.on("ready",async()=>{await ge()});m.on("update",async()=>{await ge()});m.on("error",async()=>{console.error("Unleash error"),m.stop(),await me.updateAll(Me.flags),setTimeout(()=>{m.start()},1e4)});const ge=async()=>{let o={};o=He.reduce((n,e)=>{if(e==="key-warning-ad-block"){const t=m.getVariant(e);if(!t.enabled)n[e]=H;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const s=JSON.parse(r),i=s.banner&&typeof s.banner.actionButtonLink=="string"&&typeof s.banner.actionButtonText=="string"&&typeof s.banner.cancelText=="string"&&typeof s.banner.description=="string"&&typeof s.banner.title=="string",a=s.popup&&typeof s.popup.actionButtonLink=="string"&&typeof s.popup.actionButtonText=="string"&&typeof s.popup.cancelText1=="string"&&typeof s.popup.cancelText2=="string"&&typeof s.popup.description=="object"&&typeof s.popup.title1=="string"&&typeof s.popup.title2=="string"&&typeof s.popup.showCountdown=="boolean"&&typeof s.popup.videoLink=="string",u=typeof s.max_date=="string"||s.max_date===null;if(!(i&&u&&a))throw new Error;n[e]={enabled:m.isEnabled(e),payload:s}}catch(s){n[e]=H,console.warn(`Invalid payload for flag key-warning-ad-block

`,s)}}else n[e]=H,console.warn("Invalid payload for flag key-warning-ad-block")}else if(e==="modals"){const t=m.getVariant(e);if(!t.enabled)n[e]=V;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const i=JSON.parse(r).filter(a=>{const u=!!a.id,l=!!a.version,c=!!a.title,d=!!a.afterDescription,g=!!a.beforeDescription,b=!!a.subTitle;return u&&l&&c&&(d||g||b)});n[e]={enabled:m.isEnabled(e),payload:i}}catch(s){n[e]=V,console.warn(`Invalid payload for flag modals

`,s)}}else n[e]=V,console.warn("Invalid payload for flag modals")}else if(e==="news"){const t=m.getVariant(e);if(!t.enabled)n[e]=q;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const i=JSON.parse(r).filter(a=>{const u=!!a.id,l=!!a.title,c=!!a.description;return u&&l&&c});n[e]={enabled:m.isEnabled(e),payload:i}}catch(s){n[e]=q,console.warn(`Invalid payload for flag news

`,s)}}else n[e]=q,console.warn("Invalid payload for flag news")}else if(e==="dashboard-audio-help-video"||e==="dashboard-document-help-video"||e==="dashboard-funnel-help-video"||e==="dashboard-home-help-video"||e==="dashboard-media-help-video"||e==="dashboard-message-help-video"||e==="dashboard-trigger-help-video"){const t=m.getVariant(e);if(!t.enabled)n[e]=W;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const s=JSON.parse(r);if(!s["video-url"])throw new Error("No video-url");n[e]={enabled:m.isEnabled(e),payload:{"video-url":s["video-url"]}}}catch(s){n[e]=W,console.warn(`Invalid payload for flag ${e}

`,s)}}else n[e]=W,console.warn(`Invalid payload for flag ${e}`)}else n[e]=m.isEnabled(e);return n},{}),await me.updateAll(o)};let z=!1;const ve=async o=>{z||(z=!0,await m.updateContext({userId:o??void 0}),z=!1)},ot=async o=>{await ve(o),await m.start()},it=`${K("oRHdwNnOv8SYwBnL6FGc29WajVmLj9WbuImc")}/unauthorized/special-register/step2`;class he{constructor(n){N(this,"interval",null);N(this,"tries",0);this.options=n}clear(){this.interval&&clearInterval(this.interval),this.tries=0}start(){this.clear(),this.interval=setInterval(async()=>{if(this.tries+=1,this.tries>=this.options.maxTries)return this.clear();const n=R.flags["usage-limit"],{authError:e,isPremium:t}=await S.refreshPremium(n);if(!e&&t)return this.clear()},this.options.msBetweenTries)}}Be();const de=chrome.runtime.getManifest(),M=de.version_name||de.version,X=chrome.runtime.id;setTimeout(async()=>{await Y.clear()},0);chrome.tabs.onRemoved.addListener(async(o,n)=>{if(n.isWindowClosing)return await Y.clear();const e=await C(),t=await pe(chrome.runtime.getURL("dashboard.html"));if(!e&&!t)return await Y.clear()});chrome.tabs.onUpdated.addListener(async(o,n,e)=>{var u;const{status:t,url:r}=e;if(n.status==="complete"&&t==="complete"&&(r!=null&&r.startsWith(it))){const l=new URL(r).searchParams,c=l.get("key"),d=l.get("keyId"),g=l.get("managerId"),b=l.get("ownerId"),w=R.flags["usage-limit"];c&&d&&g&&b&&await S.login({key:c,keyId:d,managerId:g,ownerId:b,shouldGetUsage:w})}if(n.status==="complete"&&t==="complete"&&(r!=null&&r.startsWith("https://zapvoice.com.br/pagina-obrigado"))&&new he({maxTries:12,msBetweenTries:2e4}).start(),n.status==="complete"&&t==="complete"&&(r!=null&&r.startsWith("https://pay.zapvoice.com.br/invoice"))&&new he({maxTries:10,msBetweenTries:9e4}).start(),n.status!=="loading")return;const a=Le();if((u=e.url)!=null&&u.startsWith(a)){const l=new URL(e.url).searchParams,c=l.get("key"),d=l.get("keyId"),g=l.get("managerId"),b=l.get("ownerId");chrome.tabs.remove(o);const w=R.flags["usage-limit"];if(c&&d&&g&&b){const x=await S.login({key:c,keyId:d,managerId:g,ownerId:b,shouldGetUsage:w});pe(chrome.runtime.getURL("")).then(I=>{I!=null&&I.id&&(Ie.auth.sendFinishExternalLoginRequest(x),chrome.tabs.update(I.id,{active:!0,highlighted:!0}))})}}});chrome.runtime.onInstalled.addListener(async o=>{const n=o.reason===chrome.runtime.OnInstalledReason.INSTALL,e=o.reason===chrome.runtime.OnInstalledReason.UPDATE;if(n||e){const t=await C();t!=null&&t.id?chrome.tabs.reload(t.id):chrome.tabs.create({url:"https://web.whatsapp.com",active:!0})}if(n){const t=new URL("https://zapvoice.com.br/install-page");t.searchParams.append("utm_source","chrome_extension"),t.searchParams.append("utm_medium","install_page"),t.searchParams.append("utm_campaign",X),t.searchParams.append("utm_id",M),chrome.tabs.create({url:t.toString()})}});chrome.runtime.onUpdateAvailable.addListener(()=>{chrome.runtime.reload()});T.startup.listenWhatsappInitRequestRequest(o=>{var t;if(je()<102)return;function e(r){chrome.scripting.executeScript({files:["static/js/importLoader/index.js"],target:{tabId:r,allFrames:!0},world:"MAIN"})}(t=o.tab)!=null&&t.id?e(o.tab.id):C(!0).then(r=>{r!=null&&r.id&&e(r.id)})});const at=async o=>{const n=Object.keys(o),e=await C();e!=null&&e.id&&chrome.tabs.sendMessage(e.id,{type:"INFO_SW_STORE_CHANGED",data:{topics:n}}).catch(t=>{console.log(t)})};ke.addChromeStorageListener(at);S.addListener(async()=>{const o=S.wppVersion??"",n=S.phoneNumber??"",e=S.key??"",t=new URL("https://zapvoice.com.br/uninstall-page");t.searchParams.append("extensionId",X),t.searchParams.append("key",e),t.searchParams.append("phoneNumber",n),t.searchParams.append("version",M),t.searchParams.append("wppVersion",o),t.searchParams.append("utm_source","chrome_extension"),t.searchParams.append("utm_medium","uninstall_button"),t.searchParams.append("utm_campaign",X),t.searchParams.append("utm_id",M),chrome.runtime.setUninstallURL(t.toString());const r=JSON.stringify(R.getByName("key-warning-ad-block"));await ve(S.key);const s=JSON.stringify(R.getByName("key-warning-ad-block"));if(r!==s){const i=R.flags["usage-limit"];S.refreshPremium(i)}});setTimeout(async()=>{ot(S.key)},3e3);const ct=new _e;ct.setTrackerUserProperties({zapvoiceVersion:M??null});T.auth.listenFetchBackendAuthDataExternalRequest();T.util.listenGetExtensionVersionExternalRequest();T.util.listenOpenDashboardExternalRequest();T.util.listenPostToWebhookExternalRequest();T.util.listenWhatsappSendBeaconExternalRequest();T.customerEvent.listenPostBackendCustomerEventExternalRequest();T.usageLimit.listenFetchBackendUsageLimitDataExternalRequest();T.usageLimit.listenFetchBackendGetUsageLimitDataExternalRequest();setInterval(async()=>{const o=R.flags["usage-limit"];await S.refreshPremium(o)},1e3*60*60*24);
